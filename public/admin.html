<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>ê´€ë¦¬ì í˜ì´ì§€ - 2025 ë””ìì¸-ê¸°ìˆ  í˜‘ì—… ì „ì£¼ê¸°ì§€ì›</title>
  <style>
    * {margin: 0; padding: 0; box-sizing: border-box;}
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      color: #ffffff;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1600px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 40px;
      padding: 40px 20px;
    }
    
    .logo {
      width: 90px;
      height: 90px;
      margin: 0 auto 25px;
      background: linear-gradient(135deg, #DC2626, #EF4444);
      border-radius: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 20px 60px rgba(220, 38, 38, 0.4);
      animation: pulse 2s ease-in-out infinite;
    }
    
    .logo-icon {
      font-size: 45px;
    }
    
    h1 {
      font-size: 38px;
      font-weight: 700;
      margin-bottom: 15px;
      background: linear-gradient(135deg, #DC2626, #ffffff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .subtitle {
      font-size: 19px;
      color: #a0a0a0;
      font-weight: 400;
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      border-bottom: 2px solid #2a2a2a;
    }
    
    .tab {
      padding: 15px 30px;
      background: transparent;
      border: none;
      color: #a0a0a0;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
    }
    
    .tab:hover {
      color: #ffffff;
    }
    
    .tab.active {
      color: #DC2626;
      border-bottom-color: #DC2626;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .view-toggle {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .view-btn {
      padding: 10px 20px;
      background: #1a1a1a;
      border: 2px solid #2a2a2a;
      color: #ffffff;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .view-btn:hover {
      background: #2a2a2a;
      border-color: #DC2626;
    }
    
    .view-btn.active {
      background: #DC2626;
      border-color: #DC2626;
    }
    
    .sheet-container {
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 30px;
      height: 80vh;
      min-height: 600px;
    }
    
    .sheet-iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 8px;
      background: #ffffff;
    }
    
    .sheet-url-input {
      width: 100%;
      padding: 12px;
      background: #1a1a1a;
      border: 2px solid #2a2a2a;
      border-radius: 8px;
      color: #ffffff;
      font-size: 14px;
      margin-bottom: 15px;
    }
    
    .sheet-url-input:focus {
      outline: none;
      border-color: #DC2626;
    }
    
    .sheet-help {
      background: #2a2a2a;
      border: 1px solid #3a3a3a;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      font-size: 13px;
      color: #a0a0a0;
      line-height: 1.6;
    }
    
    .sheet-help strong {
      color: #DC2626;
    }
    
    .toolbar {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 12px 24px;
      background: #1a1a1a;
      border: 2px solid #2a2a2a;
      color: #ffffff;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn:hover {
      background: #2a2a2a;
      border-color: #DC2626;
    }
    
    .btn-primary {
      background: #DC2626;
      border-color: #DC2626;
    }
    
    .btn-primary:hover {
      background: #B91C1C;
      border-color: #B91C1C;
    }
    
    .table-container {
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      border-radius: 16px;
      padding: 20px;
      overflow-x: auto;
      margin-bottom: 30px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    
    th {
      background: #2a2a2a;
      color: #ffffff;
      padding: 12px 8px;
      text-align: left;
      font-weight: 600;
      border: 1px solid #3a3a3a;
      white-space: nowrap;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    th:first-child {
      position: sticky;
      left: 0;
      z-index: 11;
      background: #2a2a2a;
    }
    
    td {
      padding: 8px;
      border: 1px solid #3a3a3a;
      background: #1a1a1a;
    }
    
    td:first-child {
      position: sticky;
      left: 0;
      z-index: 9;
      background: #1a1a1a;
    }
    
    tr:hover td {
      background: #2a2a2a;
    }
    
    input, textarea {
      width: 100%;
      padding: 8px;
      background: #1a1a1a;
      border: 1px solid #3a3a3a;
      border-radius: 4px;
      color: #ffffff;
      font-size: 14px;
      font-family: inherit;
    }
    
    input:focus, textarea:focus {
      outline: none;
      border-color: #DC2626;
      background: #2a2a2a;
    }
    
    textarea {
      resize: vertical;
      min-height: 60px;
    }
    
    .btn-delete {
      padding: 6px 12px;
      background: #DC2626;
      border: none;
      color: #ffffff;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
    }
    
    .btn-delete:hover {
      background: #B91C1C;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      background: #1a1a1a;
      border: 2px solid #DC2626;
      border-radius: 8px;
      color: #ffffff;
      font-weight: 600;
      z-index: 1000;
      display: none;
      animation: slideIn 0.3s ease-out;
    }
    
    .notification.show {
      display: block;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        box-shadow: 0 20px 60px rgba(220, 38, 38, 0.4);
      }
      50% {
        box-shadow: 0 20px 80px rgba(220, 38, 38, 0.6);
      }
    }
    
    .footer {
      text-align: center;
      margin-top: 60px;
      padding-top: 30px;
      border-top: 1px solid #2a2a2a;
    }
    
    .footer-text {
      font-size: 14px;
      color: #a0a0a0;
      margin-bottom: 8px;
    }
    
    .footer-org {
      font-size: 13px;
      color: #a0a0a0;
      margin-bottom: 8px;
    }
    
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      animation: fadeIn 0.3s ease-out;
    }
    
    .modal-content {
      background: #1a1a1a;
      margin: 10% auto;
      padding: 40px;
      border: 2px solid #2a2a2a;
      border-radius: 20px;
      width: 90%;
      max-width: 500px;
      position: relative;
      animation: slideDown 0.3s ease-out;
    }
    
    .modal-close {
      position: absolute;
      right: 20px;
      top: 20px;
      font-size: 32px;
      font-weight: bold;
      color: #a0a0a0;
      cursor: pointer;
      transition: color 0.2s;
    }
    
    .modal-close:hover {
      color: #DC2626;
    }
    
    .modal-input {
      width: 100%;
      padding: 16px 20px;
      background: #2a2a2a;
      border: 2px solid #3a3a3a;
      border-radius: 12px;
      color: #ffffff;
      font-size: 16px;
      margin-bottom: 20px;
      box-sizing: border-box;
    }
    
    .modal-input:focus {
      outline: none;
      border-color: #DC2626;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @media (max-width: 768px) {
      .toolbar {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
      
      .tabs {
        overflow-x: auto;
      }
      
      .tab {
        white-space: nowrap;
      }
    }
    .btn-pulse {
      animation: pulseGlow 1.8s ease-in-out infinite;
    }

    @keyframes pulseGlow {
      0% {
        box-shadow: 0 0 0 rgba(16, 185, 129, 0.0);
      }
      50% {
        box-shadow: 0 0 12px rgba(16, 185, 129, 0.45);
      }
      100% {
        box-shadow: 0 0 0 rgba(16, 185, 129, 0.0);
      }
    }
  </style>
  <link rel="stylesheet" href="/vendor/tabulator/tabulator_midnight.min.css">
  <script src="/vendor/tabulator/tabulator.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">
        <span class="logo-icon">âš™ï¸</span>
      </div>
      <h1>ê´€ë¦¬ì í˜ì´ì§€</h1>
      <p class="subtitle">2025 ë””ìì¸-ê¸°ìˆ  í˜‘ì—… ì „ì£¼ê¸°ì§€ì›</p>
    </div>
    
    <div class="tabs">
      <button class="tab active" data-tab="tech">ê¸°ìˆ ê¸°ì—…</button>
      <button class="tab" data-tab="design">ë””ìì¸ì „ë¬¸ê¸°ì—…</button>
      <button class="tab" data-tab="selections">ë°‹ì—… ì‹ ì²­ ë°ì´í„°</button>
      <button class="tab" data-tab="matching">ë§¤ì¹­ ìš°ì„ ìˆœìœ„</button>
      <button class="tab" data-tab="assignment">ë¼ìš´ë“œ ë°°ì •</button>
    </div>
    
    <!-- ê¸°ìˆ ê¸°ì—… íƒ­ -->
    <div id="techTab" class="tab-content active">
      <div class="view-toggle">
        <button class="view-btn active" data-view="sheet" data-tab="tech">Google Sheets í¸ì§‘</button>
        <button class="view-btn" data-view="table" data-tab="tech">ë¡œì»¬ í…Œì´ë¸” í¸ì§‘</button>
      </div>
      
      <!-- Google Sheets ë·° -->
      <div id="techSheetView" class="sheet-view">
        <div class="sheet-help">
          <strong>ğŸ“‹ ì‚¬ìš© ë°©ë²•:</strong><br>
          1. ì•„ë˜ ì…ë ¥ë€ì— Google Sheets í¸ì§‘ URLì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: https://docs.google.com/spreadsheets/d/SPREADSHEET_ID/edit#gid=GID)<br>
          2. ë˜ëŠ” CSV URLì—ì„œ ìë™ìœ¼ë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (CSV URL ì…ë ¥ í›„ ë³€í™˜ ë²„íŠ¼ í´ë¦­)<br>
          3. Google Sheetsì—ì„œ "ê³µìœ " ì„¤ì •ì„ "í¸ì§‘ì"ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤
        </div>
        <input 
          type="text" 
          id="techSheetUrl" 
          class="sheet-url-input" 
          placeholder="Google Sheets í¸ì§‘ URLì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: https://docs.google.com/spreadsheets/d/.../edit#gid=...)"
          value="https://docs.google.com/spreadsheets/d/1NtM1995L4n_mhRyPymqEhul_Dmeif3ayjdUq_QoGzik/edit?usp=sharing"
        />
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
          <button class="btn" onclick="loadSheetFromCSV('tech')">CSV URLì—ì„œ ë³€í™˜</button>
          <button class="btn btn-primary" onclick="loadSheet('tech')">ì‹œíŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button class="btn" onclick="openSheetInNewTab('tech')">ìƒˆ íƒ­ì—ì„œ ì—´ê¸°</button>
        </div>
        <div class="sheet-container">
          <iframe id="techSheetFrame" class="sheet-iframe" src="about:blank"></iframe>
        </div>
      </div>
      
      <!-- ë¡œì»¬ í…Œì´ë¸” ë·° -->
      <div id="techTableView" class="table-view" style="display: none;">
        <div class="toolbar">
          <button class="btn btn-primary" onclick="addRow('tech')">+ í–‰ ì¶”ê°€</button>
          <button class="btn" onclick="exportCSV('tech')">CSV ë‚´ë³´ë‚´ê¸°</button>
          <button class="btn" onclick="importCSV('tech')">CSV ê°€ì ¸ì˜¤ê¸°</button>
          <button class="btn" onclick="saveData('tech')">ì €ì¥</button>
          <button class="btn" onclick="loadData('tech')">ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button class="btn" onclick="location.href='index.html'">í™ˆìœ¼ë¡œ</button>
        </div>
        
        <div class="table-container">
          <table id="techTable">
            <thead>
              <tr>
                <th>ê¸°ì—…ëª…</th>
                <th>ì‚¬ìš©ì ì´ë¦„</th>
                <th>ê¸°ì—…ê·œëª¨</th>
                <th>ê¸°ì—… êµ¬ë¶„</th>
                <th>ì£¼ìš” ì‚¬ì—… ë¶„ì•¼</th>
                <th>ì£¼ìš” ì—­ëŸ‰</th>
                <th>ê°„ëµì†Œê°œ</th>
                <th>ë°‹ì—… ì°¸ê°€ ëª©ì </th>
                <th>ê´€ì‹¬ë¶„ì•¼_1</th>
                <th>ê´€ì‹¬ë¶„ì•¼_2</th>
                <th>ê´€ì‹¬ë¶„ì•¼_3</th>
                <th>ê´€ì‹¬ë¶„ì•¼_4</th>
                <th>ê´€ì‹¬ë¶„ì•¼_5</th>
                <th>ê´€ì‹¬ë¶„ì•¼_6</th>
                <th>ì—°ë½ì²˜</th>
                <th>ì´ë©”ì¼</th>
                <th>ì°¸ì„ì¸ì›</th>
                <th>ì°¸ì„ì</th>
                <th>ì‚­ì œ</th>
              </tr>
            </thead>
            <tbody id="techTableBody">
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- ìˆ˜ë™ ë°°ì • ì…ë ¥ ëª¨ë‹¬ -->
    <div id="manualAssignmentModal" class="modal" style="display: none;" onclick="if(event.target === this) closeManualAssignmentModal();">
      <div class="modal-content" style="max-width: 960px;" onclick="event.stopPropagation();">
        <span class="modal-close" onclick="closeManualAssignmentModal()">&times;</span>
        <h2 style="color: #DC2626; margin-bottom: 20px;">âœï¸ ìˆ˜ë™ìœ¼ë¡œ ë¼ìš´ë“œ ë°°ì • ì…ë ¥</h2>
        <p style="color: #a0a0a0; margin-bottom: 15px; line-height: 1.6;">
          í‘œì—ì„œ ë°”ë¡œ ê°’ì„ ìˆ˜ì •í•˜ê±°ë‚˜, ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì—ì„œ <strong>Ctrl/âŒ˜ + V</strong>ë¡œ ë¶™ì—¬ë„£ìœ¼ë©´ í–‰ê³¼ ì—´ì´ ê·¸ëŒ€ë¡œ ë“¤ì–´ì˜µë‹ˆë‹¤. ì—´ ìˆœì„œëŠ” <strong>ë¼ìš´ë“œ â†’ í…Œì´ë¸” â†’ ê¸°ìˆ ê¸°ì—… â†’ ë””ìì¸ê¸°ì—… â†’ ë§¤ì¹­ì ìˆ˜</strong> ì…ë‹ˆë‹¤. ì…ë ¥í•œ í…ìŠ¤íŠ¸ëŠ” ê°€ê³µ ì—†ì´ ê·¸ëŒ€ë¡œ ì €ì¥Â·í‘œì‹œë©ë‹ˆë‹¤.
        </p>
        <div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center; margin-bottom: 15px;">
          <button class="btn btn-primary" onclick="addManualGridRow()">+ í–‰ ì¶”ê°€</button>
          <button class="btn" onclick="removeManualGridRows()">ì„ íƒ í–‰ ì‚­ì œ</button>
          <button class="btn" onclick="clearManualGridRows()">ì „ì²´ ì§€ìš°ê¸°</button>
          <span style="color: #9CA3AF; font-size: 12px; margin-left: auto;">Tip: í‘œë¥¼ í´ë¦­í•œ ë’¤ Ctrl/âŒ˜ + Vë¡œ ì—¬ëŸ¬ í–‰ì„ í•œ ë²ˆì— ë¶™ì—¬ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
        </div>
        <div id="manualAssignmentGrid" style="height: 360px; border-radius: 8px; overflow: hidden;"></div>
        <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
          <button class="btn" onclick="closeManualAssignmentModal()">ë‹«ê¸°</button>
          <button class="btn btn-primary" onclick="applyManualAssignment()">ì ìš©í•˜ê¸°</button>
        </div>
      </div>
    </div>
    <!-- ë””ìì¸ì „ë¬¸ê¸°ì—… íƒ­ -->
    <div id="designTab" class="tab-content">
      <div class="view-toggle">
        <button class="view-btn active" data-view="sheet" data-tab="design">Google Sheets í¸ì§‘</button>
        <button class="view-btn" data-view="table" data-tab="design">ë¡œì»¬ í…Œì´ë¸” í¸ì§‘</button>
      </div>
      
      <!-- Google Sheets ë·° -->
      <div id="designSheetView" class="sheet-view">
        <div class="sheet-help">
          <strong>ğŸ“‹ ì‚¬ìš© ë°©ë²•:</strong><br>
          1. ì•„ë˜ ì…ë ¥ë€ì— Google Sheets í¸ì§‘ URLì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: https://docs.google.com/spreadsheets/d/SPREADSHEET_ID/edit#gid=GID)<br>
          2. ë˜ëŠ” CSV URLì—ì„œ ìë™ìœ¼ë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (CSV URL ì…ë ¥ í›„ ë³€í™˜ ë²„íŠ¼ í´ë¦­)<br>
          3. Google Sheetsì—ì„œ "ê³µìœ " ì„¤ì •ì„ "í¸ì§‘ì"ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤
        </div>
        <input 
          type="text" 
          id="designSheetUrl" 
          class="sheet-url-input" 
          placeholder="Google Sheets í¸ì§‘ URLì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: https://docs.google.com/spreadsheets/d/.../edit#gid=...)"
          value="https://docs.google.com/spreadsheets/d/1pBe5mM1Y64vBU2LnLTpwO-jFuUgyEkanNemrGxx13_s/edit?usp=sharing"
        />
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
          <button class="btn" onclick="loadSheetFromCSV('design')">CSV URLì—ì„œ ë³€í™˜</button>
          <button class="btn btn-primary" onclick="loadSheet('design')">ì‹œíŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button class="btn" onclick="openSheetInNewTab('design')">ìƒˆ íƒ­ì—ì„œ ì—´ê¸°</button>
        </div>
        <div class="sheet-container">
          <iframe id="designSheetFrame" class="sheet-iframe" src="about:blank"></iframe>
        </div>
      </div>
      
      <!-- ë¡œì»¬ í…Œì´ë¸” ë·° -->
      <div id="designTableView" class="table-view" style="display: none;">
        <div class="toolbar">
          <button class="btn btn-primary" onclick="addRow('design')">+ í–‰ ì¶”ê°€</button>
          <button class="btn" onclick="exportCSV('design')">CSV ë‚´ë³´ë‚´ê¸°</button>
          <button class="btn" onclick="importCSV('design')">CSV ê°€ì ¸ì˜¤ê¸°</button>
          <button class="btn" onclick="saveData('design')">ì €ì¥</button>
          <button class="btn" onclick="loadData('design')">ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button class="btn" onclick="location.href='index.html'">í™ˆìœ¼ë¡œ</button>
        </div>
        
        <div class="table-container">
          <table id="designTable">
            <thead>
              <tr>
                <th>ê¸°ì—…ëª…</th>
                <th>ì‚¬ìš©ì ì´ë¦„</th>
                <th>ê¸°ì—…ê·œëª¨</th>
                <th>ê¸°ì—… êµ¬ë¶„</th>
                <th>ì£¼ìš” ì‚¬ì—… ë¶„ì•¼_1</th>
                <th>ì£¼ìš” ì‚¬ì—… ë¶„ì•¼_2</th>
                <th>ì£¼ìš” ì‚¬ì—… ë¶„ì•¼_3</th>
                <th>ì£¼ìš” ì‚¬ì—… ë¶„ì•¼_4</th>
                <th>ì£¼ìš” ì‚¬ì—… ë¶„ì•¼_5</th>
                <th>ì£¼ìš” ì—­ëŸ‰</th>
                <th>ê°„ëµì†Œê°œ</th>
                <th>ë°‹ì—… ì°¸ê°€ ëª©ì </th>
                <th>ê´€ì‹¬ë¶„ì•¼_1</th>
                <th>ê´€ì‹¬ë¶„ì•¼_2</th>
                <th>ê´€ì‹¬ë¶„ì•¼_3</th>
                <th>ê´€ì‹¬ë¶„ì•¼_4</th>
                <th>ê´€ì‹¬ë¶„ì•¼_5</th>
                <th>ì—°ë½ì²˜</th>
                <th>ì´ë©”ì¼</th>
                <th>ì°¸ì„ì¸ì›</th>
                <th>ì°¸ì„ì</th>
                <th>ì‚­ì œ</th>
              </tr>
            </thead>
            <tbody id="designTableBody">
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- ë°‹ì—… ì‹ ì²­ ë°ì´í„° íƒ­ -->
    <div id="selectionsTab" class="tab-content">
      <div style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
        <button class="btn btn-primary" onclick="loadSelectionsData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        <button class="btn" onclick="exportSelectionsCSV()">ğŸ“¥ CSV ë‹¤ìš´ë¡œë“œ</button>
        <span id="selectionsCount" style="color: #a0a0a0; margin-left: auto;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
      </div>
      
      <div style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center;">
        <input 
          type="text" 
          id="selectionsSearch" 
          placeholder="ì´ë©”ì¼ ë˜ëŠ” ê¸°ì—…ëª…ìœ¼ë¡œ ê²€ìƒ‰..." 
          style="flex: 1; padding: 10px; background: #2a2a2a; border: 1px solid #3a3a3a; border-radius: 8px; color: #ffffff; font-size: 14px;"
          onkeyup="filterSelections()"
        />
        <select 
          id="selectionsListTypeFilter" 
          style="padding: 10px; background: #2a2a2a; border: 1px solid #3a3a3a; border-radius: 8px; color: #ffffff; font-size: 14px;"
          onchange="filterSelections()"
        >
          <option value="">ì „ì²´ ëª©ë¡</option>
          <option value="tech">ê¸°ìˆ ê¸°ì—…</option>
          <option value="design">ë””ìì¸ì „ë¬¸ê¸°ì—…</option>
        </select>
      </div>
      
      <div class="table-container" style="overflow-x: auto;">
        <table id="selectionsTable" style="width: 100%; border-collapse: collapse; background: #1a1a1a; border-radius: 8px; overflow: hidden;">
          <thead>
            <tr style="background: #2a2a2a;">
              <th onclick="sortSelections('email')" style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600; cursor: pointer; user-select: none;" title="í´ë¦­í•˜ì—¬ ì •ë ¬">ì´ë©”ì¼ <span id="sort-email" style="font-size: 10px;">â†•</span></th>
              <th onclick="sortSelections('company')" style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600; cursor: pointer; user-select: none;" title="í´ë¦­í•˜ì—¬ ì •ë ¬">ì†Œì† ê¸°ì—…ëª… <span id="sort-company" style="font-size: 10px;">â†•</span></th>
              <th onclick="sortSelections('listType')" style="padding: 12px; text-align: center; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600; cursor: pointer; user-select: none;" title="í´ë¦­í•˜ì—¬ ì •ë ¬">ëª©ë¡ íƒ€ì… <span id="sort-listType" style="font-size: 10px;">â†•</span></th>
              <th onclick="sortSelections('priority1')" style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600; cursor: pointer; user-select: none;" title="í´ë¦­í•˜ì—¬ ì •ë ¬">1ìˆœìœ„ <span id="sort-priority1" style="font-size: 10px;">â†•</span></th>
              <th onclick="sortSelections('priority2')" style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600; cursor: pointer; user-select: none;" title="í´ë¦­í•˜ì—¬ ì •ë ¬">2ìˆœìœ„ <span id="sort-priority2" style="font-size: 10px;">â†•</span></th>
              <th onclick="sortSelections('priority3')" style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600; cursor: pointer; user-select: none;" title="í´ë¦­í•˜ì—¬ ì •ë ¬">3ìˆœìœ„ <span id="sort-priority3" style="font-size: 10px;">â†•</span></th>
              <th onclick="sortSelections('priority4')" style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600; cursor: pointer; user-select: none;" title="í´ë¦­í•˜ì—¬ ì •ë ¬">4ìˆœìœ„ <span id="sort-priority4" style="font-size: 10px;">â†•</span></th>
              <th onclick="sortSelections('priority5')" style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600; cursor: pointer; user-select: none;" title="í´ë¦­í•˜ì—¬ ì •ë ¬">5ìˆœìœ„ <span id="sort-priority5" style="font-size: 10px;">â†•</span></th>
              <th onclick="sortSelections('priority6')" style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600; cursor: pointer; user-select: none;" title="í´ë¦­í•˜ì—¬ ì •ë ¬">6ìˆœìœ„ <span id="sort-priority6" style="font-size: 10px;">â†•</span></th>
              <th onclick="sortSelections('priority7')" style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600; cursor: pointer; user-select: none;" title="í´ë¦­í•˜ì—¬ ì •ë ¬">7ìˆœìœ„ <span id="sort-priority7" style="font-size: 10px;">â†•</span></th>
              <th onclick="sortSelections('createdAt')" style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600; cursor: pointer; user-select: none;" title="í´ë¦­í•˜ì—¬ ì •ë ¬">ìƒì„± ì‹œê°„ <span id="sort-createdAt" style="font-size: 10px;">â†•</span></th>
              <th onclick="sortSelections('updatedAt')" style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600; cursor: pointer; user-select: none;" title="í´ë¦­í•˜ì—¬ ì •ë ¬">ìˆ˜ì • ì‹œê°„ <span id="sort-updatedAt" style="font-size: 10px;">â†•</span></th>
            </tr>
          </thead>
          <tbody id="selectionsTableBody">
            <tr>
              <td colspan="12" style="padding: 40px; text-align: center; color: #a0a0a0;">
                ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- ì•„ì§ ì‹ ì²­í•˜ì§€ ì•Šì€ ê¸°ì—… ëª©ë¡ -->
      <div id="unappliedCompaniesSection" style="margin-top: 30px; padding: 20px; background: #2a2a2a; border-radius: 8px; border-left: 4px solid #EF4444; display: none;">
        <h3 style="color: #EF4444; margin-bottom: 15px;">âŒ ì•„ì§ ì‹ ì²­í•˜ì§€ ì•Šì€ ê¸°ì—…</h3>
        <div style="margin-bottom: 15px; padding: 15px; background: #1a1a1a; border-radius: 6px;">
          <div style="display: flex; gap: 30px; color: #a0a0a0; font-size: 14px;">
            <div>
              <span style="color: #ffffff; font-weight: 600;">ê¸°ìˆ ê¸°ì—…:</span> 
              ì‹ ì²­ ì™„ë£Œ <span id="appliedTechCount" style="color: #10B981; font-weight: 600;">0</span>ê°œ / 
              ë¯¸ì‹ ì²­ <span id="unappliedTechCount" style="color: #EF4444; font-weight: 600;">0</span>ê°œ
            </div>
            <div>
              <span style="color: #ffffff; font-weight: 600;">ë””ìì¸ì „ë¬¸ê¸°ì—…:</span> 
              ì‹ ì²­ ì™„ë£Œ <span id="appliedDesignCount" style="color: #10B981; font-weight: 600;">0</span>ê°œ / 
              ë¯¸ì‹ ì²­ <span id="unappliedDesignCount" style="color: #EF4444; font-weight: 600;">0</span>ê°œ
            </div>
          </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
          <div>
            <h4 style="color: #EF4444; margin-bottom: 10px; font-size: 16px;">ê¸°ìˆ ê¸°ì—… (<span id="unappliedTechCountLabel">0</span>ê°œ)</h4>
            <div id="unappliedTechList" style="max-height: 400px; overflow-y: auto; padding: 10px; background: #1a1a1a; border-radius: 6px;">
            </div>
          </div>
          <div>
            <h4 style="color: #EF4444; margin-bottom: 10px; font-size: 16px;">ë””ìì¸ì „ë¬¸ê¸°ì—… (<span id="unappliedDesignCountLabel">0</span>ê°œ)</h4>
            <div id="unappliedDesignList" style="max-height: 400px; overflow-y: auto; padding: 10px; background: #1a1a1a; border-radius: 6px;">
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ë§¤ì¹­ ìš°ì„ ìˆœìœ„ íƒ­ -->
    <div id="matchingTab" class="tab-content">
      <div style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center;">
        <button class="btn btn-primary" onclick="loadMatchingData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        <button class="btn" onclick="exportMatchingCSV()">ğŸ“¥ CSV ë‹¤ìš´ë¡œë“œ</button>
        <span id="matchingCount" style="color: #a0a0a0; margin-left: auto;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
      </div>
      
      <div style="margin-bottom: 15px; padding: 15px; background: #2a2a2a; border-radius: 8px; border-left: 4px solid #DC2626;">
        <strong style="color: #DC2626;">ğŸ“Š ë§¤ì¹­ ì ìˆ˜ ê³„ì‚° ë°©ì‹:</strong>
        <ul style="margin: 10px 0 0 20px; color: #a0a0a0; line-height: 1.8;">
          <li>1ìˆœìœ„ ì„ íƒ = 7ì , 2ìˆœìœ„ = 6ì , ..., 7ìˆœìœ„ = 1ì , ì„ íƒ ì•ˆ í•¨ = 0ì </li>
          <li>ì–‘ë°©í–¥ ë§¤ì¹­: ì–‘ë°©í–¥ ì ìˆ˜ í•©ì‚° (ìµœëŒ€ 14ì )</li>
          <li>ì¼ë°©í–¥ ë§¤ì¹­: ì¼ë°© ì ìˆ˜ë§Œ ì‚¬ìš© (ìµœëŒ€ 7ì )</li>
          <li>ì˜ˆ: ê¸°ìˆ ê¸°ì—… Aê°€ ë””ìì¸ê¸°ì—… Bë¥¼ 1ìˆœìœ„(7ì ) + ë””ìì¸ê¸°ì—… Bê°€ ê¸°ìˆ ê¸°ì—… Aë¥¼ 2ìˆœìœ„(6ì ) = ì´ 13ì  (ì–‘ë°©í–¥)</li>
          <li>ì˜ˆ: ê¸°ìˆ ê¸°ì—… Aê°€ ë””ìì¸ê¸°ì—… Bë¥¼ 1ìˆœìœ„(7ì ) + ë””ìì¸ê¸°ì—… Bê°€ ì„ íƒ ì•ˆ í•¨(0ì ) = ì´ 7ì  (ì¼ë°©í–¥)</li>
        </ul>
      </div>
      
      <div style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center;">
        <input 
          type="text" 
          id="matchingSearch" 
          placeholder="ê¸°ìˆ ê¸°ì—…ëª… ë˜ëŠ” ë””ìì¸ê¸°ì—…ëª…ìœ¼ë¡œ ê²€ìƒ‰..." 
          style="flex: 1; padding: 10px; background: #2a2a2a; border: 1px solid #3a3a3a; border-radius: 8px; color: #ffffff; font-size: 14px;"
          onkeyup="filterMatching()"
        />
        <select 
          id="matchingSortBy" 
          style="padding: 10px; background: #2a2a2a; border: 1px solid #3a3a3a; border-radius: 8px; color: #ffffff; font-size: 14px;"
          onchange="filterMatching()"
        >
          <option value="score-desc">ì ìˆ˜ ë†’ì€ ìˆœ</option>
          <option value="score-asc">ì ìˆ˜ ë‚®ì€ ìˆœ</option>
          <option value="tech-asc">ê¸°ìˆ ê¸°ì—…ëª… ìˆœ</option>
          <option value="design-asc">ë””ìì¸ê¸°ì—…ëª… ìˆœ</option>
        </select>
        <input 
          type="number" 
          id="matchingMinScore" 
          placeholder="ìµœì†Œ ì ìˆ˜" 
          min="0" 
          max="14"
          style="width: 120px; padding: 10px; background: #2a2a2a; border: 1px solid #3a3a3a; border-radius: 8px; color: #ffffff; font-size: 14px;"
          onkeyup="filterMatching()"
          onchange="filterMatching()"
        />
      </div>
      
      <div class="table-container" style="overflow-x: auto;">
        <table id="matchingTable" style="width: 100%; border-collapse: collapse; background: #1a1a1a; border-radius: 8px; overflow: hidden;">
          <thead>
            <tr style="background: #2a2a2a;">
              <th style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600;">ìˆœìœ„</th>
              <th style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600;">ê¸°ìˆ ê¸°ì—…</th>
              <th style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600;">ë””ìì¸ê¸°ì—…</th>
              <th style="padding: 12px; text-align: center; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600;">ê¸°ìˆ â†’ë””ìì¸<br/>ì ìˆ˜</th>
              <th style="padding: 12px; text-align: center; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600;">ë””ìì¸â†’ê¸°ìˆ <br/>ì ìˆ˜</th>
              <th style="padding: 12px; text-align: center; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600;">ì´ì </th>
              <th style="padding: 12px; text-align: center; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600;">ê¸°ìˆ ê¸°ì—…<br/>ì„ íƒ ìˆœìœ„</th>
              <th style="padding: 12px; text-align: center; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600;">ë””ìì¸ê¸°ì—…<br/>ì„ íƒ ìˆœìœ„</th>
            </tr>
          </thead>
          <tbody id="matchingTableBody">
            <tr>
              <td colspan="8" style="padding: 40px; text-align: center; color: #a0a0a0;">
                ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- ë¼ìš´ë“œ ë°°ì • íƒ­ -->
    <div id="assignmentTab" class="tab-content">
      <div style="margin-bottom: 20px; padding: 20px; background: #2a2a2a; border-radius: 8px; border-left: 4px solid #DC2626;">
        <h3 style="color: #DC2626; margin-bottom: 15px;">ğŸ“… ë¼ìš´ë“œ ë°°ì • ì„¤ì •</h3>
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 10px; color: #a0a0a0; font-size: 14px; font-weight: 600;">ë°°ì • ë°©ì‹</label>
          <div style="display: flex; flex-direction: column; gap: 10px;">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #1a1a1a; border-radius: 8px; border: 2px solid #3a3a3a; transition: all 0.2s;">
              <input type="radio" name="assignmentMode" value="priority" checked style="width: 18px; height: 18px; cursor: pointer;">
              <div>
                <div style="color: #ffffff; font-weight: 600; margin-bottom: 3px;">ë§¤ì¹­ í¬ì¸íŠ¸ë¥¼ ìš°ì„ ìœ¼ë¡œ</div>
                <div style="color: #a0a0a0; font-size: 12px;">ìƒí˜¸ ë°‹ì—… í¬ë§ì •ë„ì— ë”°ë¼ ë°°ì •</div>
              </div>
            </label>
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #1a1a1a; border-radius: 8px; border: 2px solid #3a3a3a; transition: all 0.2s;">
              <input type="radio" name="assignmentMode" value="guarantee1" style="width: 18px; height: 18px; cursor: pointer;">
              <div>
                <div style="color: #ffffff; font-weight: 600; margin-bottom: 3px;">ì ì–´ë„ 1ê°œ ì´ìƒì˜ ë°‹ì—…ì„ ë³´ì¥í•˜ê¸°</div>
                <div style="color: #a0a0a0; font-size: 12px;">ëª¨ë“  íŒ€ì´ ìµœì†Œ 1íšŒ ì´ìƒ ë°°ì •ë˜ë„ë¡ ë³´ì¥ (ë§¤ì¹­ ì—†ëŠ” íŒ€ ì œì™¸)</div>
              </div>
            </label>
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #1a1a1a; border-radius: 8px; border: 2px solid #3a3a3a; transition: all 0.2s;">
              <input type="radio" name="assignmentMode" value="guaranteeX" style="width: 18px; height: 18px; cursor: pointer;">
              <div style="flex: 1;">
                <div style="color: #ffffff; font-weight: 600; margin-bottom: 3px;">ëª¨ë“  íŒ€ë“¤ì´ ë™ë“±í•˜ê²Œ ë°‹ì—…í•˜ê¸°</div>
                <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;">
                  <span style="color: #a0a0a0; font-size: 12px;">ëª¨ë“  íŒ€ì´ ì •í™•íˆ</span>
                  <input 
                    type="number" 
                    id="guaranteeRoundCount" 
                    min="1" 
                    max="10"
                    value="2"
                    style="width: 60px; padding: 6px; background: #2a2a2a; border: 1px solid #3a3a3a; border-radius: 6px; color: #ffffff; font-size: 13px;"
                  />
                  <span style="color: #a0a0a0; font-size: 12px;">íšŒ ë°°ì •ë˜ë„ë¡ ë³´ì¥ (ë³´ì¥ í›„ ë‚¨ì€ ìŠ¬ë¡¯ì€ í¬ì¸íŠ¸ ìˆœìœ¼ë¡œ ì¶”ê°€ ë°°ì •)</span>
                </div>
              </div>
            </label>
          </div>
          <div>
            <label style="display: flex; align-items: center; gap: 10px; padding: 12px; background: #2a2a2a; border-radius: 8px; cursor: pointer; transition: background 0.2s;">
              <input type="radio" name="assignmentMode" value="smallerGroup" style="width: 18px; height: 18px; cursor: pointer;">
              <div style="flex: 1;">
                <div style="color: #ffffff; font-weight: 600; margin-bottom: 3px;">ì ì€ ê·¸ë£¹ ì „ì²´ ë¼ìš´ë“œ ë°°ì •</div>
                <div style="color: #a0a0a0; font-size: 12px;">ê¸°ì¤€ ê·¸ë£¹ì˜ ëª¨ë“  íŒ€ì´ ëª¨ë“  ë¼ìš´ë“œì— ë°°ì •ë˜ë„ë¡ ë³´ì¥</div>
                <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;">
                  <span style="color: #a0a0a0; font-size: 12px;">ê¸°ì¤€ ê·¸ë£¹:</span>
                  <select 
                    id="baseGroupSelect" 
                    style="padding: 6px; background: #1a1a1a; border: 1px solid #3a3a3a; border-radius: 6px; color: #ffffff; font-size: 12px;"
                  >
                    <option value="tech">ê¸°ìˆ ê¸°ì—…</option>
                    <option value="design">ë””ìì¸ì „ë¬¸ê¸°ì—…</option>
                  </select>
                </div>
              </div>
            </label>
          </div>
        </div>
        <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
          <div>
            <label style="display: block; margin-bottom: 5px; color: #a0a0a0; font-size: 14px;">ë¼ìš´ë“œ ìˆ˜</label>
            <input 
              type="number" 
              id="roundCount" 
              min="1" 
              max="10"
              value="3"
              onchange="checkFixedSeatSection()"
              style="width: 100px; padding: 10px; background: #1a1a1a; border: 1px solid #3a3a3a; border-radius: 8px; color: #ffffff; font-size: 14px;"
            />
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; color: #a0a0a0; font-size: 14px;">í…Œì´ë¸” ìˆ˜ (ë¼ìš´ë“œë‹¹)</label>
            <input 
              type="number" 
              id="tableCount" 
              min="1" 
              max="50"
              value="10"
              onchange="checkFixedSeatSection(); if(document.getElementById('fixedSeatTableContainer').style.display !== 'none') loadFixedSeatCompanies();"
              style="width: 100px; padding: 10px; background: #1a1a1a; border: 1px solid #3a3a3a; border-radius: 8px; color: #ffffff; font-size: 14px;"
            />
          </div>
               <div style="margin-top: 25px;">
                 <button class="btn btn-primary" onclick="generateAssignment()">ğŸš€ ë°°ì • ìƒì„±</button>
                <button class="btn" id="confirmAssignmentBtn" onclick="confirmAssignment()" style="margin-left: 10px; display: none; background: #10B981; border-color: #10B981;">âœ… ì´ëŒ€ë¡œ í™•ì •í•˜ê¸°</button>
                <button class="btn" id="resetAssignmentBtn" onclick="resetAssignment()" style="margin-left: 10px; display: none; background: #EF4444; border-color: #EF4444;">ğŸ”„ ë°°ì • ìƒˆë¡œí•˜ê¸°</button>
                <button class="btn" id="clearAssignmentBtn" onclick="clearAssignment()" style="margin-left: 10px; display: none; background: #6B7280; border-color: #6B7280;">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
                 <button class="btn" onclick="exportAssignmentCSV()" style="margin-left: 10px;">ğŸ“¥ CSV ë‹¤ìš´ë¡œë“œ</button>
                 <button class="btn" id="noShowBtn" onclick="openNoShowModal()" style="margin-left: 10px; display: none; background: #EF4444; border-color: #EF4444;">ğŸš« ë…¸ì‡¼ ì²˜ë¦¬</button>
                <button class="btn" onclick="openManualAssignmentModal()" style="margin-left: 10px; background: #3B82F6; border-color: #3B82F6; color: #ffffff;">âœï¸ ìˆ˜ë™ ì…ë ¥</button>
               </div>
               <div id="confirmedInfo" style="margin-top: 15px; padding: 15px; background: #1a1a1a; border-radius: 8px; border-left: 4px solid #10B981; display: none;">
                 <div style="color: #10B981; font-weight: 600; margin-bottom: 5px;">âœ… í™•ì •ëœ ë°°ì •</div>
                 <div style="color: #a0a0a0; font-size: 13px;">
                   <span id="confirmedVersion">ë²„ì „: -</span> | 
                   <span id="confirmedTime">í™•ì • ì‹œê°„: -</span>
                 </div>
               </div>
        </div>
        <div style="margin-top: 15px; padding: 10px; background: #1a1a1a; border-radius: 6px; font-size: 13px; color: #a0a0a0;">
          <strong style="color: #DC2626;">ğŸ’¡ ì•ˆë‚´:</strong> ë§¤ì¹­ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ìë™ìœ¼ë¡œ ë°°ì •ë©ë‹ˆë‹¤. ê° ë¼ìš´ë“œì—ì„œ ê°™ì€ ê¸°ì—…ì€ í•œ í…Œì´ë¸”ì—ë§Œ ë°°ì •ë©ë‹ˆë‹¤.
        </div>
      </div>
      
      <div id="assignmentResult" style="display: none;">
        <div style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center;">
          <span id="assignmentSummary" style="color: #a0a0a0; font-size: 14px;"></span>
        </div>
        
        <!-- ë°°ì • ê²°ê³¼ í…Œì´ë¸” -->
        <div id="assignmentTables" style="margin-bottom: 30px;"></div>
        
             <!-- ë°°ì • í†µê³„ ì„¹ì…˜ -->
             <div id="assignmentStats" style="display: none; margin-top: 30px;">
               <h3 style="color: #DC2626; margin-bottom: 15px;">ğŸ“Š ë°°ì • í†µê³„</h3>
               <div id="assignmentStatsContent"></div>
             </div>
             
             <!-- ì „ì²´ ê¸°ì—… ë¦¬ìŠ¤íŠ¸ (ë¼ìš´ë“œ ìˆ˜ ê¸°ì¤€) -->
             <div id="allCompaniesList" style="display: none; margin-top: 30px;">
               <h3 style="color: #DC2626; margin-bottom: 15px;">ğŸ“‹ ì „ì²´ ê¸°ì—… ë¦¬ìŠ¤íŠ¸ (ë¼ìš´ë“œ ë°°ì • ìˆ˜ ê¸°ì¤€)</h3>
               <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                 <div>
                   <h4 style="color: #DC2626; margin-bottom: 15px; font-size: 18px;">ê¸°ìˆ ê¸°ì—…</h4>
                   <div id="allTechCompaniesList" style="max-height: 600px; overflow-y: auto;"></div>
                 </div>
                 <div>
                   <h4 style="color: #DC2626; margin-bottom: 15px; font-size: 18px;">ë””ìì¸ê¸°ì—…</h4>
                   <div id="allDesignCompaniesList" style="max-height: 600px; overflow-y: auto;"></div>
                 </div>
               </div>
             </div>
             
             <!-- ë§¤ì¹­ì´ ì—†ëŠ” íŒ€ ëª©ë¡ -->
             <div id="noMatchingSection" style="display: none; margin-top: 30px;">
               <h3 style="color: #DC2626; margin-bottom: 15px;">âŒ ë§¤ì¹­ì´ ì—†ëŠ” íŒ€</h3>
          <div style="margin-bottom: 15px; padding: 15px; background: #2a2a2a; border-radius: 8px; border-left: 4px solid #DC2626;">
            <p style="color: #a0a0a0; font-size: 13px; line-height: 1.6;">
              ì–‘ë°©í–¥ ë§¤ì¹­ë„ ì¼ë°©í–¥ ë§¤ì¹­ë„ ì „í˜€ ì—†ëŠ” ê¸°ì—…ë“¤ì…ë‹ˆë‹¤. ì´ ê¸°ì—…ë“¤ì€ ë‹¤ë¥¸ ê¸°ì—…ì„ ì„ íƒí•˜ì§€ ì•Šì•˜ê±°ë‚˜, ì„ íƒí•œ ê¸°ì—…ì´ ì´ ê¸°ì—…ì„ ì„ íƒí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
            </p>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
              <h4 style="color: #DC2626; margin-bottom: 10px; font-size: 16px;">ê¸°ìˆ ê¸°ì—…</h4>
              <div class="table-container" style="overflow-x: auto;">
                <table id="noMatchingTechTable" style="width: 100%; border-collapse: collapse; background: #1a1a1a; border-radius: 8px; overflow: hidden;">
                  <thead>
                    <tr style="background: #2a2a2a;">
                      <th style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600;">ìˆœìœ„</th>
                      <th style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600;">ê¸°ì—…ëª…</th>
                    </tr>
                  </thead>
                  <tbody id="noMatchingTechTableBody">
                  </tbody>
                </table>
              </div>
            </div>
            <div>
              <h4 style="color: #DC2626; margin-bottom: 10px; font-size: 16px;">ë””ìì¸ê¸°ì—…</h4>
              <div class="table-container" style="overflow-x: auto;">
                <table id="noMatchingDesignTable" style="width: 100%; border-collapse: collapse; background: #1a1a1a; border-radius: 8px; overflow: hidden;">
                  <thead>
                    <tr style="background: #2a2a2a;">
                      <th style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600;">ìˆœìœ„</th>
                      <th style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600;">ê¸°ì—…ëª…</th>
                    </tr>
                  </thead>
                  <tbody id="noMatchingDesignTableBody">
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- ë…¸ì‡¼ ì²˜ë¦¬ ëª¨ë‹¬ -->
      <div id="noShowModal" class="modal" style="display: none;" onclick="if(event.target === this) closeNoShowModal();">
        <div class="modal-content" style="max-width: 600px;" onclick="event.stopPropagation();">
          <span class="modal-close" onclick="closeNoShowModal()">&times;</span>
          <h2 style="color: #DC2626; margin-bottom: 20px;">ğŸš« ë…¸ì‡¼ ì²˜ë¦¬</h2>
          <p style="color: #a0a0a0; margin-bottom: 20px; line-height: 1.6;">
            í™•ì •ëœ ë°°ì •ì—ì„œ ë…¸ì‡¼ë¡œ ì²˜ë¦¬í•  ê¸°ì—…ì„ ì„ íƒí•˜ì„¸ìš”. í•´ë‹¹ ê¸°ì—…ì´ í¬í•¨ëœ ëª¨ë“  ë°°ì •ì´ ì œì™¸ë©ë‹ˆë‹¤.
          </p>
          <div style="margin-bottom: 20px; position: relative;">
            <label style="display: block; margin-bottom: 8px; color: #a0a0a0; font-size: 14px;">ê¸°ì—…ëª…</label>
            <input 
              type="text" 
              id="noShowCompanyName" 
              class="modal-input" 
              placeholder="ê¸°ì—…ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
              autocomplete="off"
              oninput="filterCompanyNames(this.value)"
              onblur="setTimeout(() => document.getElementById('noShowCompanySuggestions').style.display = 'none', 200);"
            />
            <div id="noShowCompanySuggestions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: #1a1a1a; border: 1px solid #3a3a3a; border-radius: 8px; max-height: 200px; overflow-y: auto; z-index: 1001; margin-top: 4px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);"></div>
          </div>
          <div style="display: flex; gap: 10px;">
            <button class="btn" onclick="processNoShow()" style="background: #EF4444; border-color: #EF4444; flex: 1;">ë…¸ì‡¼ ì²˜ë¦¬</button>
            <button class="btn" onclick="closeNoShowModal()" style="background: #2a2a2a; border-color: #3a3a3a; flex: 1;">ì·¨ì†Œ</button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="footer">
      <p class="footer-text">2025 ë””ìì¸-ê¸°ìˆ  í˜‘ì—… ì „ì£¼ê¸°ì§€ì›</p>
      <p class="footer-org">ì£¼ìµœ: ì‚°ì—…í†µìƒë¶€, ì£¼ê´€: í•œêµ­ë””ìì¸ì§„í¥ì›, ìš´ì˜: MYSC</p>
    </div>
  </div>
  
  <div id="notification" class="notification"></div>
  
  <input type="file" id="csvFileInput" accept=".csv" style="display: none;" onchange="handleFileSelect(event)">
  
  <script>
    // ê¸°ìˆ ê¸°ì—… ì»¬ëŸ¼ ì •ì˜ (ì‹¤ì œ CSV í—¤ë” ê¸°ì¤€)
    const techColumns = [
      'ê¸°ì—…ëª…', 'ì‚¬ìš©ì ì´ë¦„', 'ê¸°ì—…ê·œëª¨', 'ê¸°ì—… êµ¬ë¶„', 'ì£¼ìš” ì‚¬ì—… ë¶„ì•¼', 
      'ì£¼ìš” ì—­ëŸ‰', 'ê°„ëµì†Œê°œ', 'ë°‹ì—… ì°¸ê°€ ëª©ì ', 'ê´€ì‹¬ë¶„ì•¼_1', 'ê´€ì‹¬ë¶„ì•¼_2', 'ê´€ì‹¬ë¶„ì•¼_3', 
      'ê´€ì‹¬ë¶„ì•¼_4', 'ê´€ì‹¬ë¶„ì•¼_5', 'ê´€ì‹¬ë¶„ì•¼_6',
      'ì—°ë½ì²˜', 'ì´ë©”ì¼', 'ì°¸ì„ì¸ì›', 'ì°¸ì„ì'
    ];
    
    // ë””ìì¸ì „ë¬¸ê¸°ì—… ì»¬ëŸ¼ ì •ì˜ (ì‹¤ì œ CSV í—¤ë” ê¸°ì¤€)
    const designColumns = [
      'ê¸°ì—…ëª…', 'ì‚¬ìš©ì ì´ë¦„', 'ê¸°ì—…ê·œëª¨', 'ê¸°ì—… êµ¬ë¶„', 
      'ì£¼ìš” ì‚¬ì—… ë¶„ì•¼_1', 'ì£¼ìš” ì‚¬ì—… ë¶„ì•¼_2', 'ì£¼ìš” ì‚¬ì—… ë¶„ì•¼_3', 'ì£¼ìš” ì‚¬ì—… ë¶„ì•¼_4', 'ì£¼ìš” ì‚¬ì—… ë¶„ì•¼_5',
      'ì£¼ìš” ì—­ëŸ‰', 'ê°„ëµì†Œê°œ', 'ë°‹ì—… ì°¸ê°€ ëª©ì ', 
      'ê´€ì‹¬ë¶„ì•¼_1', 'ê´€ì‹¬ë¶„ì•¼_2', 'ê´€ì‹¬ë¶„ì•¼_3', 'ê´€ì‹¬ë¶„ì•¼_4', 'ê´€ì‹¬ë¶„ì•¼_5',
      'ì—°ë½ì²˜', 'ì´ë©”ì¼', 'ì°¸ì„ì¸ì›', 'ì°¸ì„ì'
    ];
    
    let currentTab = 'tech';
    let techData = [];
    let designData = [];
    
    // Google Sheets í¸ì§‘ URL (ê¸°ë³¸ê°’)
    const TECH_SHEET_EDIT_URL = 'https://docs.google.com/spreadsheets/d/1NtM1995L4n_mhRyPymqEhul_Dmeif3ayjdUq_QoGzik/edit?usp=sharing';
    const DESIGN_SHEET_EDIT_URL = 'https://docs.google.com/spreadsheets/d/1pBe5mM1Y64vBU2LnLTpwO-jFuUgyEkanNemrGxx13_s/edit?usp=sharing';
    
    // CSV URL (í¸ì§‘ URLì—ì„œ ìë™ ìƒì„±)
    function getCSVUrl(editUrl) {
      // í¸ì§‘ URLì—ì„œ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ID ì¶”ì¶œ
      const match = editUrl.match(/\/d\/([a-zA-Z0-9-_]+)/);
      if (match) {
        const spreadsheetId = match[1];
        // CSV URL í˜•ì‹: /d/e/{SPREADSHEET_ID}/pub?output=csv
        return `https://docs.google.com/spreadsheets/d/e/${spreadsheetId}/pub?output=csv`;
      }
      return null;
    }
    
    const TECH_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTdxkwUoTKh5y5xLeMwerXez9IpL6_QEY09ipRULpS-R60XiiSVMWC3LEjgVzHU57_EjlIVvg1LfSw_/pub?output=csv';
    const DESIGN_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRH6aVLkutbRv8_gv9kSdHS62fmcYV6_sLBRjGoPQyHHahyWMBdEm7nLVLPlkrnGccKXB462N9ZgKyK/pub?output=csv';
    
    // CSV URLì—ì„œ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ IDì™€ GID ì¶”ì¶œí•˜ì—¬ í¸ì§‘ URL ìƒì„±
    function convertCSVUrlToEditUrl(csvUrl) {
      try {
        // CSV URL í˜•ì‹: https://docs.google.com/spreadsheets/d/e/SPREADSHEET_ID/pub?gid=GID&single=true&output=csv
        const match = csvUrl.match(/\/d\/e\/([^\/]+)\/pub\?gid=(\d+)/);
        if (match) {
          const spreadsheetId = match[1];
          const gid = match[2];
          return `https://docs.google.com/spreadsheets/d/${spreadsheetId}/edit#gid=${gid}`;
        }
        return null;
      } catch (e) {
        return null;
      }
    }
    
    // ê¸°ë³¸ ì‹œíŠ¸ URL ë¡œë“œ
    function loadSheetFromCSV(type) {
      const editUrl = type === 'tech' ? TECH_SHEET_EDIT_URL : DESIGN_SHEET_EDIT_URL;
      const urlInput = document.getElementById(type + 'SheetUrl');
      urlInput.value = editUrl;
      loadSheet(type);
      showNotification('ê¸°ë³¸ Google Sheetsë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
    }
    
    // Google Sheets ë¡œë“œ
    function loadSheet(type) {
      const urlInput = document.getElementById(type + 'SheetUrl');
      const url = urlInput.value.trim();
      
      if (!url) {
        showNotification('Google Sheets URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // URL ìœ íš¨ì„± ê²€ì‚¬
      if (!url.includes('docs.google.com/spreadsheets')) {
        showNotification('ì˜¬ë°”ë¥¸ Google Sheets URLì´ ì•„ë‹™ë‹ˆë‹¤.');
        return;
      }
      
      // iframeì— ë¡œë“œ
      const frame = document.getElementById(type + 'SheetFrame');
      frame.src = url;
      
      // LocalStorageì— ì €ì¥
      localStorage.setItem(`kidp2025_${type}_sheet_url`, url);
      
      showNotification('Google Sheetsë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
    }
    
    // ìƒˆ íƒ­ì—ì„œ ì—´ê¸°
    function openSheetInNewTab(type) {
      const urlInput = document.getElementById(type + 'SheetUrl');
      const url = urlInput.value.trim();
      
      if (!url) {
        showNotification('Google Sheets URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      window.open(url, '_blank');
    }
    
    // ë·° ì „í™˜
    document.querySelectorAll('.view-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const view = btn.dataset.view;
        const tab = btn.dataset.tab;
        
        // ê°™ì€ íƒ­ì˜ ë‹¤ë¥¸ ë·° ë²„íŠ¼ ë¹„í™œì„±í™”
        document.querySelectorAll(`.view-btn[data-tab="${tab}"]`).forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // ë·° ì „í™˜
        if (view === 'sheet') {
          document.getElementById(tab + 'SheetView').style.display = 'block';
          document.getElementById(tab + 'TableView').style.display = 'none';
        } else {
          document.getElementById(tab + 'SheetView').style.display = 'none';
          document.getElementById(tab + 'TableView').style.display = 'block';
        }
      });
    });
    
    // íƒ­ ì „í™˜
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.dataset.tab;
        currentTab = tabName;
        
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        
        tab.classList.add('active');
        const tabElement = document.getElementById(tabName + 'Tab');
        if (tabElement) {
          tabElement.classList.add('active');
        }
        
        // ë°‹ì—… ì‹ ì²­ ë°ì´í„° íƒ­ì´ í™œì„±í™”ë˜ë©´ ë°ì´í„° ìë™ ë¡œë“œ
        if (tabName === 'selections') {
          loadSelectionsData();
        }
        
        // ë§¤ì¹­ ìš°ì„ ìˆœìœ„ íƒ­ì´ í™œì„±í™”ë˜ë©´ ë°ì´í„° ìë™ ë¡œë“œ
        if (tabName === 'matching') {
          loadMatchingData();
        }
        
        // ë¼ìš´ë“œ ë°°ì • íƒ­ì´ í™œì„±í™”ë˜ë©´ í™•ì •ëœ ë°°ì • ë°ì´í„° ë¡œë“œ
        if (tabName === 'assignment') {
          // í™•ì •ëœ ë°°ì • ì •ë³´ ë° ë°ì´í„° ë¡œë“œ
          loadConfirmedAssignment();
          
          // ë§¤ì¹­ ë°ì´í„°ë„ ë¯¸ë¦¬ ë¡œë“œ (ë°°ì • ìƒì„± ì‹œ í•„ìš”)
          if (!allMatchingData || allMatchingData.length === 0) {
            loadMatchingData();
          }
        }
      });
    });
    
    // í–‰ ì¶”ê°€
    function addRow(type) {
      const columns = type === 'tech' ? techColumns : designColumns;
      const tbody = document.getElementById(type + 'TableBody');
      const row = document.createElement('tr');
      
      let html = '';
      columns.forEach(col => {
        html += `<td><input type="text" data-field="${col}" placeholder="${col}"></td>`;
      });
      html += `<td><button class="btn-delete" onclick="deleteRow(this)">ì‚­ì œ</button></td>`;
      
      row.innerHTML = html;
      tbody.appendChild(row);
      
      // ì²« ë²ˆì§¸ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
      const firstInput = row.querySelector('input');
      if (firstInput) firstInput.focus();
      
      showNotification('í–‰ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
    
    // í–‰ ì‚­ì œ
    function deleteRow(btn) {
      if (confirm('ì´ í–‰ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        btn.closest('tr').remove();
        showNotification('í–‰ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    // ë°ì´í„° ì €ì¥ (LocalStorage)
    function saveData(type) {
      const tbody = document.getElementById(type + 'TableBody');
      const rows = tbody.querySelectorAll('tr');
      const data = [];
      
      const columns = type === 'tech' ? techColumns : designColumns;
      
      rows.forEach(row => {
        const rowData = {};
        columns.forEach(col => {
          const input = row.querySelector(`input[data-field="${col}"]`);
          rowData[col] = input ? input.value.trim() : '';
        });
        // ë¹ˆ í–‰ì€ ì œì™¸
        if (rowData[columns[0]]) {
          data.push(rowData);
        }
      });
      
      localStorage.setItem(`kidp2025_${type}_data`, JSON.stringify(data));
      
      if (type === 'tech') {
        techData = data;
      } else {
        designData = data;
      }
      
      showNotification(`${type === 'tech' ? 'ê¸°ìˆ ê¸°ì—…' : 'ë””ìì¸ì „ë¬¸ê¸°ì—…'} ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }
    
    // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (LocalStorage)
    function loadData(type) {
      const stored = localStorage.getItem(`kidp2025_${type}_data`);
      if (!stored) {
        showNotification('ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const data = JSON.parse(stored);
      const tbody = document.getElementById(type + 'TableBody');
      tbody.innerHTML = '';
      
      const columns = type === 'tech' ? techColumns : designColumns;
      
      data.forEach(rowData => {
        const row = document.createElement('tr');
        let html = '';
        columns.forEach(col => {
          const value = rowData[col] || '';
          html += `<td><input type="text" data-field="${col}" value="${escapeHtml(value)}" placeholder="${col}"></td>`;
        });
        html += `<td><button class="btn-delete" onclick="deleteRow(this)">ì‚­ì œ</button></td>`;
        row.innerHTML = html;
        tbody.appendChild(row);
      });
      
      if (type === 'tech') {
        techData = data;
      } else {
        designData = data;
      }
      
      showNotification(`${type === 'tech' ? 'ê¸°ìˆ ê¸°ì—…' : 'ë””ìì¸ì „ë¬¸ê¸°ì—…'} ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
    }
    
    // CSV ë‚´ë³´ë‚´ê¸°
    function exportCSV(type) {
      const tbody = document.getElementById(type + 'TableBody');
      const rows = tbody.querySelectorAll('tr');
      const columns = type === 'tech' ? techColumns : designColumns;
      
      // í—¤ë”
      let csv = columns.map(col => escapeCSV(col)).join(',') + '\n';
      
      // ë°ì´í„°
      rows.forEach(row => {
        const values = [];
        columns.forEach(col => {
          const input = row.querySelector(`input[data-field="${col}"]`);
          values.push(escapeCSV(input ? input.value.trim() : ''));
        });
        csv += values.join(',') + '\n';
      });
      
      // BOM ì¶”ê°€ (í•œê¸€ ê¹¨ì§ ë°©ì§€)
      const BOM = '\uFEFF';
      const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `${type === 'tech' ? 'tech_companies' : 'design_companies'}_${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showNotification('CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
    
    // CSV ê°€ì ¸ì˜¤ê¸°
    function importCSV(type) {
      document.getElementById('csvFileInput').click();
      document.getElementById('csvFileInput').dataset.type = type;
    }
    
    // íŒŒì¼ ì„ íƒ ì²˜ë¦¬
    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const type = event.target.dataset.type;
      const reader = new FileReader();
      
      reader.onload = (e) => {
        const text = e.target.result;
        parseAndImportCSV(text, type);
      };
      
      reader.readAsText(file, 'UTF-8');
    }
    
    // CSV íŒŒì‹± ë° ê°€ì ¸ì˜¤ê¸°
    function parseAndImportCSV(text, type) {
      const lines = text.split(/\r?\n/).filter(line => line.trim());
      if (lines.length < 2) {
        showNotification('CSV íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        return;
      }
      
      // BOM ì œê±°
      if (lines[0].charCodeAt(0) === 0xFEFF) {
        lines[0] = lines[0].substring(1);
      }
      
      // í—¤ë” íŒŒì‹±
      const headers = parseCSVLine(lines[0]);
      const columns = type === 'tech' ? techColumns : designColumns;
      
      // ë°ì´í„° íŒŒì‹±
      const data = [];
      for (let i = 1; i < lines.length; i++) {
        const values = parseCSVLine(lines[i]);
        const rowData = {};
        columns.forEach((col, idx) => {
          rowData[col] = values[idx] || '';
        });
        if (rowData[columns[0]]) {
          data.push(rowData);
        }
      }
      
      // í…Œì´ë¸”ì— í‘œì‹œ
      const tbody = document.getElementById(type + 'TableBody');
      tbody.innerHTML = '';
      
      data.forEach(rowData => {
        const row = document.createElement('tr');
        let html = '';
        columns.forEach(col => {
          const value = rowData[col] || '';
          html += `<td><input type="text" data-field="${col}" value="${escapeHtml(value)}" placeholder="${col}"></td>`;
        });
        html += `<td><button class="btn-delete" onclick="deleteRow(this)">ì‚­ì œ</button></td>`;
        row.innerHTML = html;
        tbody.appendChild(row);
      });
      
      if (type === 'tech') {
        techData = data;
      } else {
        designData = data;
      }
      
      showNotification(`${data.length}ê°œì˜ ${type === 'tech' ? 'ê¸°ìˆ ê¸°ì—…' : 'ë””ìì¸ì „ë¬¸ê¸°ì—…'} ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`);
    }
    
    // CSV ë¼ì¸ íŒŒì‹± (ì‰¼í‘œì™€ ë”°ì˜´í‘œ ì²˜ë¦¬)
    function parseCSVLine(line) {
      const values = [];
      let current = '';
      let inQuotes = false;
      
      for (let i = 0; i < line.length; i++) {
        const char = line[i];
        const nextChar = line[i + 1];
        
        if (char === '"') {
          if (inQuotes && nextChar === '"') {
            current += '"';
            i++;
          } else {
            inQuotes = !inQuotes;
          }
        } else if (char === ',' && !inQuotes) {
          values.push(current.trim());
          current = '';
        } else {
          current += char;
        }
      }
      values.push(current.trim());
      return values;
    }
    
    // CSV ì´ìŠ¤ì¼€ì´í”„
    function escapeCSV(value) {
      if (value.includes(',') || value.includes('"') || value.includes('\n')) {
        return '"' + value.replace(/"/g, '""') + '"';
      }
      return value;
    }
    
    // HTML ì´ìŠ¤ì¼€ì´í”„
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // ì•Œë¦¼ í‘œì‹œ
    function showNotification(message) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }
    
    // ë°‹ì—… ì‹ ì²­ ë°ì´í„° ê´€ë ¨ ë³€ìˆ˜
    let allSelectionsData = [];
    let filteredSelectionsData = [];
    let selectionsSortColumn = null;
    let selectionsSortDirection = 'asc'; // 'asc' or 'desc'
    let userCompanyMap = {}; // ì´ë©”ì¼ -> ì†Œì† ê¸°ì—…ëª… ë§¤í•‘
    
    // CSVì—ì„œ ì‚¬ìš©ì ì†Œì† ê¸°ì—… ì •ë³´ ë¡œë“œ
    async function loadUserCompanyMap() {
      try {
        const techRes = await fetch(TECH_CSV_URL);
        const techText = await techRes.text();
        const techData = parseCSVForUserCompany(techText);
        
        const designRes = await fetch(DESIGN_CSV_URL);
        const designText = await designRes.text();
        const designData = parseCSVForUserCompany(designText);
        
        [...techData, ...designData].forEach(entry => {
          if (entry.email && entry.companyName) {
            userCompanyMap[entry.email] = entry.companyName;
          }
        });
      } catch (error) {
        console.error('ì‚¬ìš©ì ì†Œì† ê¸°ì—… ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    
    // CSV íŒŒì‹± (ì‚¬ìš©ì ì†Œì† ê¸°ì—…ìš©)
    function parseCSVForUserCompany(text) {
      const lines = text.split(/\r?\n/).filter(line => line.trim());
      if (lines.length < 2) return [];
      
      const headers = parseCSVLine(lines[0]);
      const data = [];
      
      // í—¤ë” ì¸ë±ìŠ¤ ì°¾ê¸°
      const userEmailIdx = headers.findIndex(h => h === 'ì‚¬ìš©ì ì´ë¦„' || h === 'ì´ë©”ì¼');
      const companyNameIdx = headers.findIndex(h => h === 'ê¸°ì—…ëª…' || h === 'ë©˜í† ëª…' || h === 'ê¸°ìˆ ê¸°ì—…ëª…' || h === 'ìŠ¤íƒ€íŠ¸ì—…' || h === 'ë””ìì¸ì „ë¬¸ê¸°ì—…');
      
      if (userEmailIdx === -1 || companyNameIdx === -1) {
        console.warn('CSV í—¤ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', headers);
        return [];
      }
      
      for (let i = 1; i < lines.length; i++) {
        const values = parseCSVLine(lines[i]);
        if (values.length <= Math.max(userEmailIdx, companyNameIdx)) continue;
        
        const userEmail = (values[userEmailIdx] || '').toLowerCase().trim();
        const companyName = (values[companyNameIdx] || '').trim();
        
        if (userEmail && companyName) {
          data.push({
            email: userEmail,
            companyName
          });
        }
      }
      
      return data;
    }

    function getCompanyNameByEmail(email, fallbackName = '') {
      const normalized = (email || '').toLowerCase().trim();
      if (normalized && userCompanyMap[normalized]) {
        return userCompanyMap[normalized];
      }
      return fallbackName || normalized || '';
    }
    
    // ë°‹ì—… ì‹ ì²­ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadSelectionsData() {
      const tbody = document.getElementById('selectionsTableBody');
      const countSpan = document.getElementById('selectionsCount');
      
      tbody.innerHTML = '<tr><td colspan="12" style="padding: 40px; text-align: center; color: #a0a0a0;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
      countSpan.textContent = 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
      
      try {
        // ì‚¬ìš©ì ì†Œì† ê¸°ì—… ì •ë³´ ë¨¼ì € ë¡œë“œ
        await loadUserCompanyMap();
        
        const response = await fetch('/api/kidp2025/meetup/selections');
        const data = await response.json();
        
        if (data.success && data.selections) {
          // ì‚¬ìš©ì ì†Œì† ê¸°ì—…ëª… ì¶”ê°€
          allSelectionsData = data.selections.map(selection => {
            const email = selection.email.toLowerCase().trim();
            if (!selection.userCompany && userCompanyMap[email]) {
              selection.userCompany = userCompanyMap[email];
            }
            return selection;
          });
          
          filteredSelectionsData = [...allSelectionsData];
          
          // ì •ë ¬ ì ìš©
          if (selectionsSortColumn) {
            sortSelectionsData(selectionsSortColumn, selectionsSortDirection);
          }
          
          renderSelectionsTable();
          countSpan.textContent = `ì´ ${allSelectionsData.length}ê°œì˜ ì‹ ì²­`;
          
          // ì•„ì§ ì‹ ì²­í•˜ì§€ ì•Šì€ ê¸°ì—… ëª©ë¡ í‘œì‹œ
          await displayUnappliedCompanies();
          
          showNotification('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
        } else {
          throw new Error(data.error || 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
        tbody.innerHTML = `<tr><td colspan="12" style="padding: 40px; text-align: center; color: #DC2626;">ì˜¤ë¥˜: ${escapeHtml(error.message)}</td></tr>`;
        countSpan.textContent = 'ì˜¤ë¥˜ ë°œìƒ';
        showNotification('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    // ì•„ì§ ì‹ ì²­í•˜ì§€ ì•Šì€ ê¸°ì—… ëª©ë¡ í‘œì‹œ
    async function displayUnappliedCompanies() {
      try {
        // selections ë°ì´í„°ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¨¼ì € ë¡œë“œ
        if (!allSelectionsData || allSelectionsData.length === 0) {
          console.log('selections ë°ì´í„°ê°€ ì—†ì–´ì„œ ë¡œë“œí•©ë‹ˆë‹¤...');
          try {
            const response = await fetch('/api/kidp2025/meetup/selections');
            const data = await response.json();
            if (data.success && data.selections) {
              allSelectionsData = data.selections;
              console.log('selections ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', allSelectionsData.length, 'ê°œ');
            }
          } catch (error) {
            console.error('selections ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
          }
        }
        
        // ì‹ ì²­í•œ ì‚¬ìš©ì ì´ë©”ì¼ ìˆ˜ì§‘ (selections ë°ì´í„°ì—ì„œ)
        const appliedEmails = new Set();
        if (allSelectionsData && allSelectionsData.length > 0) {
          for (const selection of allSelectionsData) {
            // selections ë°ì´í„°ì˜ email í•„ë“œ í™•ì¸ (ë‹¤ì–‘í•œ í•„ë“œëª… ì‹œë„)
            const email = (selection.email || selection.user_email || selection.userEmail || '').toLowerCase().trim();
            if (email) {
              appliedEmails.add(email);
            }
          }
        }
        
        console.log('ì‹ ì²­í•œ ì‚¬ìš©ì ìˆ˜:', appliedEmails.size);
        console.log('ì‹ ì²­í•œ ì‚¬ìš©ì ìƒ˜í”Œ:', Array.from(appliedEmails).slice(0, 5));
        console.log('allSelectionsData ê¸¸ì´:', allSelectionsData ? allSelectionsData.length : 0);
        if (allSelectionsData && allSelectionsData.length > 0) {
          console.log('ì²« ë²ˆì§¸ selection ìƒ˜í”Œ:', allSelectionsData[0]);
        }
        
        // CSVì—ì„œ ê¸°ìˆ ê¸°ì—… ëª©ë¡ ë¡œë“œ
        const techRes = await fetch(TECH_CSV_URL);
        const techText = await techRes.text();
        const techLines = techText.split(/\r?\n/).filter(line => line.trim());
        
        const unappliedTech = [];
        if (techLines.length >= 2) {
          const headers = parseCSVLine(techLines[0]);
          const userEmailIdx = headers.findIndex(h => h === 'ì‚¬ìš©ì ì´ë¦„' || h === 'ì´ë©”ì¼');
          const companyNameIdx = headers.findIndex(h => h === 'ê¸°ì—…ëª…' || h === 'ë©˜í† ëª…' || h === 'ê¸°ìˆ ê¸°ì—…ëª…');
          
          console.log('ê¸°ìˆ ê¸°ì—… CSV í—¤ë”:', headers);
          console.log('ì‚¬ìš©ì ì´ë¦„ ì¸ë±ìŠ¤:', userEmailIdx, 'ê¸°ì—…ëª… ì¸ë±ìŠ¤:', companyNameIdx);
          
          if (userEmailIdx >= 0 && companyNameIdx >= 0) {
            let csvUserEmailSamples = [];
            for (let i = 1; i < techLines.length; i++) {
              const values = parseCSVLine(techLines[i]);
              if (values.length <= Math.max(userEmailIdx, companyNameIdx)) continue;
              
              const userEmailRaw = (values[userEmailIdx] || '').trim();
              const userEmail = userEmailRaw.toLowerCase().trim();
              const companyName = (values[companyNameIdx] || '').trim();
              
              // ì´ë©”ì¼ í˜•ì‹ ê²€ì¦ (ê°„ë‹¨í•œ ì²´í¬: @ í¬í•¨í•˜ê³  ê³µë°±ì´ ì—†ì–´ì•¼ í•¨)
              const isValidEmail = userEmail && userEmail.includes('@') && !userEmail.includes(' ') && userEmail.length > 5;
              
              // ê¸°ì—…ëª… ìœ íš¨ì„± ê²€ì‚¬: ë„ˆë¬´ ê¸¸ì§€ ì•Šê³ (100ì ì´í•˜), ìˆ«ìë¡œ ì‹œì‘í•˜ì§€ ì•Šê³ , íŠ¹ìˆ˜ íŒ¨í„´ì´ ì—†ì–´ì•¼ í•¨
              const isValidCompanyName = companyName && 
                companyName.length <= 100 && 
                companyName.length >= 1 &&
                !companyName.match(/^\d+\./) && // ìˆ«ìë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš° ì œì™¸ (ì˜ˆ: "2. í¬íŠ¸í´ë¦¬ì˜¤")
                !companyName.includes('í¬íŠ¸í´ë¦¬ì˜¤') &&
                !companyName.includes('í•µì‹¬ì—­ëŸ‰') &&
                !companyName.includes('http') &&
                !companyName.includes('www.') &&
                !companyName.includes('instagram.com') &&
                companyName.split(',').length <= 3; // ì‰¼í‘œê°€ ë„ˆë¬´ ë§ìœ¼ë©´ ì„¤ëª… í…ìŠ¤íŠ¸ë¡œ ê°„ì£¼
              
              // ìƒ˜í”Œ ìˆ˜ì§‘ (ì²˜ìŒ 5ê°œë§Œ)
              if (csvUserEmailSamples.length < 5 && userEmail) {
                csvUserEmailSamples.push({
                  raw: userEmailRaw,
                  normalized: userEmail,
                  companyName: companyName,
                  isValidEmail: isValidEmail,
                  isValidCompanyName: isValidCompanyName
                });
              }
              
              // ì‚¬ìš©ì ì´ë¦„ì´ ì´ë©”ì¼ í˜•ì‹ì´ê³ , ê¸°ì—…ëª…ì´ ìœ íš¨í•˜ê³ , ì‹ ì²­ ëª©ë¡ì— ì—†ëŠ” ê²½ìš°
              if (isValidEmail && isValidCompanyName && !appliedEmails.has(userEmail)) {
                unappliedTech.push({
                  email: userEmail,
                  name: companyName
                });
              }
            }
            console.log('ê¸°ìˆ ê¸°ì—… CSV ì‚¬ìš©ì ì´ë¦„ ìƒ˜í”Œ:', csvUserEmailSamples);
            console.log('ê¸°ìˆ ê¸°ì—… CSV ì´ í–‰ ìˆ˜:', techLines.length - 1);
          } else {
            console.error('ê¸°ìˆ ê¸°ì—… CSV í—¤ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. userEmailIdx:', userEmailIdx, 'companyNameIdx:', companyNameIdx);
          }
        }
        
        // CSVì—ì„œ ë””ìì¸ê¸°ì—… ëª©ë¡ ë¡œë“œ
        const designRes = await fetch(DESIGN_CSV_URL);
        const designText = await designRes.text();
        const designLines = designText.split(/\r?\n/).filter(line => line.trim());
        
        const unappliedDesign = [];
        if (designLines.length >= 2) {
          const headers = parseCSVLine(designLines[0]);
          const userEmailIdx = headers.findIndex(h => h === 'ì‚¬ìš©ì ì´ë¦„' || h === 'ì´ë©”ì¼');
          const companyNameIdx = headers.findIndex(h => h === 'ê¸°ì—…ëª…' || h === 'ìŠ¤íƒ€íŠ¸ì—…' || h === 'ë””ìì¸ì „ë¬¸ê¸°ì—…');
          
          console.log('ë””ìì¸ê¸°ì—… CSV í—¤ë”:', headers);
          console.log('ì‚¬ìš©ì ì´ë¦„ ì¸ë±ìŠ¤:', userEmailIdx, 'ê¸°ì—…ëª… ì¸ë±ìŠ¤:', companyNameIdx);
          
          if (userEmailIdx >= 0 && companyNameIdx >= 0) {
            let csvUserEmailSamples = [];
            for (let i = 1; i < designLines.length; i++) {
              const values = parseCSVLine(designLines[i]);
              if (values.length <= Math.max(userEmailIdx, companyNameIdx)) continue;
              
              const userEmailRaw = (values[userEmailIdx] || '').trim();
              const userEmail = userEmailRaw.toLowerCase().trim();
              const companyName = (values[companyNameIdx] || '').trim();
              
              // ì´ë©”ì¼ í˜•ì‹ ê²€ì¦ (ê°„ë‹¨í•œ ì²´í¬: @ í¬í•¨í•˜ê³  ê³µë°±ì´ ì—†ì–´ì•¼ í•¨)
              const isValidEmail = userEmail && userEmail.includes('@') && !userEmail.includes(' ') && userEmail.length > 5;
              
              // ê¸°ì—…ëª… ìœ íš¨ì„± ê²€ì‚¬: ë„ˆë¬´ ê¸¸ì§€ ì•Šê³ (100ì ì´í•˜), ìˆ«ìë¡œ ì‹œì‘í•˜ì§€ ì•Šê³ , íŠ¹ìˆ˜ íŒ¨í„´ì´ ì—†ì–´ì•¼ í•¨
              const isValidCompanyName = companyName && 
                companyName.length <= 100 && 
                companyName.length >= 1 &&
                !companyName.match(/^\d+\./) && // ìˆ«ìë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš° ì œì™¸ (ì˜ˆ: "2. í¬íŠ¸í´ë¦¬ì˜¤")
                !companyName.includes('í¬íŠ¸í´ë¦¬ì˜¤') &&
                !companyName.includes('í•µì‹¬ì—­ëŸ‰') &&
                !companyName.includes('http') &&
                !companyName.includes('www.') &&
                !companyName.includes('instagram.com') &&
                companyName.split(',').length <= 3; // ì‰¼í‘œê°€ ë„ˆë¬´ ë§ìœ¼ë©´ ì„¤ëª… í…ìŠ¤íŠ¸ë¡œ ê°„ì£¼
              
              // ìƒ˜í”Œ ìˆ˜ì§‘ (ì²˜ìŒ 5ê°œë§Œ)
              if (csvUserEmailSamples.length < 5 && userEmail) {
                csvUserEmailSamples.push({
                  raw: userEmailRaw,
                  normalized: userEmail,
                  companyName: companyName,
                  isValidEmail: isValidEmail,
                  isValidCompanyName: isValidCompanyName
                });
              }
              
              // ì‚¬ìš©ì ì´ë¦„ì´ ì´ë©”ì¼ í˜•ì‹ì´ê³ , ê¸°ì—…ëª…ì´ ìœ íš¨í•˜ê³ , ì‹ ì²­ ëª©ë¡ì— ì—†ëŠ” ê²½ìš°
              if (isValidEmail && isValidCompanyName && !appliedEmails.has(userEmail)) {
                unappliedDesign.push({
                  email: userEmail,
                  name: companyName
                });
              }
            }
            console.log('ë””ìì¸ê¸°ì—… CSV ì‚¬ìš©ì ì´ë¦„ ìƒ˜í”Œ:', csvUserEmailSamples);
            console.log('ë””ìì¸ê¸°ì—… CSV ì´ í–‰ ìˆ˜:', designLines.length - 1);
          } else {
            console.error('ë””ìì¸ê¸°ì—… CSV í—¤ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. userEmailIdx:', userEmailIdx, 'companyNameIdx:', companyNameIdx);
          }
        }
        
        console.log('ì‹ ì²­í•˜ì§€ ì•Šì€ ê¸°ìˆ ê¸°ì—… ìˆ˜:', unappliedTech.length);
        console.log('ì‹ ì²­í•˜ì§€ ì•Šì€ ë””ìì¸ê¸°ì—… ìˆ˜:', unappliedDesign.length);
        
        // ì‹ ì²­ ì™„ë£Œí•œ ê¸°ì—… ìˆ˜ ê³„ì‚°
        const appliedTechEmails = new Set();
        const appliedDesignEmails = new Set();
        if (allSelectionsData && allSelectionsData.length > 0) {
          for (const selection of allSelectionsData) {
            const email = (selection.email || selection.user_email || selection.userEmail || '').toLowerCase().trim();
            if (email) {
              // listType === 'design' ì´ë©´ ê¸°ìˆ ê¸°ì—… (ê¸°ìˆ ê¸°ì—…ì´ ë””ìì¸ê¸°ì—…ì„ ì„ íƒí•œ ê²½ìš°)
              // listType === 'tech' ì´ë©´ ë””ìì¸ê¸°ì—… (ë””ìì¸ê¸°ì—…ì´ ê¸°ìˆ ê¸°ì—…ì„ ì„ íƒí•œ ê²½ìš°)
              if (selection.listType === 'design') {
                appliedTechEmails.add(email);
              } else if (selection.listType === 'tech') {
                appliedDesignEmails.add(email);
              }
            }
          }
        }
        
        // UI ì—…ë°ì´íŠ¸
        const section = document.getElementById('unappliedCompaniesSection');
        const techListDiv = document.getElementById('unappliedTechList');
        const designListDiv = document.getElementById('unappliedDesignList');
        const techCountSpan = document.getElementById('unappliedTechCount');
        const designCountSpan = document.getElementById('unappliedDesignCount');
        const techCountLabel = document.getElementById('unappliedTechCountLabel');
        const designCountLabel = document.getElementById('unappliedDesignCountLabel');
        const appliedTechCountSpan = document.getElementById('appliedTechCount');
        const appliedDesignCountSpan = document.getElementById('appliedDesignCount');
        
        // ì‹ ì²­ ì™„ë£Œí•œ ê¸°ì—… ìˆ˜ í‘œì‹œ
        appliedTechCountSpan.textContent = appliedTechEmails.size;
        appliedDesignCountSpan.textContent = appliedDesignEmails.size;
        
        if (unappliedTech.length === 0 && unappliedDesign.length === 0) {
          section.style.display = 'none';
          return;
        }
        
        section.style.display = 'block';
        techCountSpan.textContent = unappliedTech.length;
        designCountSpan.textContent = unappliedDesign.length;
        techCountLabel.textContent = unappliedTech.length;
        designCountLabel.textContent = unappliedDesign.length;
        
        // ê¸°ìˆ ê¸°ì—… ëª©ë¡ í‘œì‹œ
        if (unappliedTech.length === 0) {
          techListDiv.innerHTML = '<div style="padding: 20px; text-align: center; color: #a0a0a0;">ì‹ ì²­í•˜ì§€ ì•Šì€ ê¸°ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        } else {
          techListDiv.innerHTML = unappliedTech
            .sort((a, b) => a.name.localeCompare(b.name, 'ko'))
            .map(company => `<div style="padding: 8px; border-bottom: 1px solid #3a3a3a; color: #ffffff;">${escapeHtml(company.name)}</div>`)
            .join('');
        }
        
        // ë””ìì¸ê¸°ì—… ëª©ë¡ í‘œì‹œ
        if (unappliedDesign.length === 0) {
          designListDiv.innerHTML = '<div style="padding: 20px; text-align: center; color: #a0a0a0;">ì‹ ì²­í•˜ì§€ ì•Šì€ ê¸°ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        } else {
          designListDiv.innerHTML = unappliedDesign
            .sort((a, b) => a.name.localeCompare(b.name, 'ko'))
            .map(company => `<div style="padding: 8px; border-bottom: 1px solid #3a3a3a; color: #ffffff;">${escapeHtml(company.name)}</div>`)
            .join('');
        }
      } catch (error) {
        console.error('ì‹ ì²­í•˜ì§€ ì•Šì€ ê¸°ì—… ëª©ë¡ í‘œì‹œ ì˜¤ë¥˜:', error);
        const section = document.getElementById('unappliedCompaniesSection');
        if (section) {
          section.style.display = 'none';
        }
      }
    }
    
    // ì •ë ¬ í•¨ìˆ˜
    function sortSelections(column) {
      if (selectionsSortColumn === column) {
        // ê°™ì€ ì»¬ëŸ¼ í´ë¦­ ì‹œ ë°©í–¥ ì „í™˜
        selectionsSortDirection = selectionsSortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        selectionsSortColumn = column;
        selectionsSortDirection = 'asc';
      }
      
      sortSelectionsData(column, selectionsSortDirection);
      renderSelectionsTable();
      updateSortIndicators();
    }
    
    // ì •ë ¬ ì‹¤í–‰
    function sortSelectionsData(column, direction) {
      filteredSelectionsData.sort((a, b) => {
        let aVal, bVal;
        
        switch(column) {
          case 'email':
            aVal = (a.email || '').toLowerCase();
            bVal = (b.email || '').toLowerCase();
            break;
          case 'company':
            aVal = (a.userCompany || '').toLowerCase();
            bVal = (b.userCompany || '').toLowerCase();
            break;
          case 'listType':
            aVal = a.listType || '';
            bVal = b.listType || '';
            break;
          case 'priority1':
          case 'priority2':
          case 'priority3':
          case 'priority4':
          case 'priority5':
          case 'priority6':
          case 'priority7':
            const priorityNum = column.replace('priority', '');
            aVal = (a[`priority${priorityNum}`] || '').toLowerCase();
            bVal = (b[`priority${priorityNum}`] || '').toLowerCase();
            break;
          case 'createdAt':
            aVal = new Date(a.createdAt || 0).getTime();
            bVal = new Date(b.createdAt || 0).getTime();
            break;
          case 'updatedAt':
            aVal = new Date(a.updatedAt || 0).getTime();
            bVal = new Date(b.updatedAt || 0).getTime();
            break;
          default:
            return 0;
        }
        
        if (aVal < bVal) return direction === 'asc' ? -1 : 1;
        if (aVal > bVal) return direction === 'asc' ? 1 : -1;
        return 0;
      });
    }
    
    // ì •ë ¬ ì¸ë””ì¼€ì´í„° ì—…ë°ì´íŠ¸
    function updateSortIndicators() {
      // ëª¨ë“  ì¸ë””ì¼€ì´í„° ì´ˆê¸°í™”
      document.querySelectorAll('[id^="sort-"]').forEach(el => {
        el.textContent = 'â†•';
      });
      
      if (selectionsSortColumn) {
        const indicator = document.getElementById(`sort-${selectionsSortColumn}`);
        if (indicator) {
          indicator.textContent = selectionsSortDirection === 'asc' ? 'â†‘' : 'â†“';
        }
      }
    }
    
    // ë°‹ì—… ì‹ ì²­ ë°ì´í„° í…Œì´ë¸” ë Œë”ë§
    function renderSelectionsTable() {
      const tbody = document.getElementById('selectionsTableBody');
      const countSpan = document.getElementById('selectionsCount');
      
      if (filteredSelectionsData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="12" style="padding: 40px; text-align: center; color: #a0a0a0;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        countSpan.textContent = 'ë°ì´í„° ì—†ìŒ';
        return;
      }
      
      tbody.innerHTML = filteredSelectionsData.map(selection => {
        const createdAt = new Date(selection.createdAt).toLocaleString('ko-KR');
        const updatedAt = new Date(selection.updatedAt).toLocaleString('ko-KR');
        const listTypeLabel = selection.listType === 'tech' ? 'ê¸°ìˆ ê¸°ì—…' : 'ë””ìì¸ì „ë¬¸ê¸°ì—…';
        const listTypeColor = selection.listType === 'tech' ? '#3B82F6' : '#10B981';
        
        return `
          <tr style="border-bottom: 1px solid #2a2a2a; transition: background 0.2s;" 
              onmouseover="this.style.background='#2a2a2a'" 
              onmouseout="this.style.background='transparent'">
            <td style="padding: 12px; color: #ffffff; font-weight: 600;">${escapeHtml(selection.email)}</td>
            <td style="padding: 12px; color: #ffffff;">${escapeHtml(selection.userCompany || '')}</td>
            <td style="padding: 12px; text-align: center;">
              <span style="padding: 4px 8px; background: ${listTypeColor}; color: #ffffff; border-radius: 4px; font-size: 12px; font-weight: 600;">
                ${listTypeLabel}
              </span>
            </td>
            <td style="padding: 12px; color: #ffffff;">${escapeHtml(selection.priority1 || '')}</td>
            <td style="padding: 12px; color: #ffffff;">${escapeHtml(selection.priority2 || '')}</td>
            <td style="padding: 12px; color: #ffffff;">${escapeHtml(selection.priority3 || '')}</td>
            <td style="padding: 12px; color: #ffffff;">${escapeHtml(selection.priority4 || '')}</td>
            <td style="padding: 12px; color: #ffffff;">${escapeHtml(selection.priority5 || '')}</td>
            <td style="padding: 12px; color: #ffffff;">${escapeHtml(selection.priority6 || '')}</td>
            <td style="padding: 12px; color: #ffffff;">${escapeHtml(selection.priority7 || '')}</td>
            <td style="padding: 12px; color: #a0a0a0; font-size: 13px;">${createdAt}</td>
            <td style="padding: 12px; color: #a0a0a0; font-size: 13px;">${updatedAt}</td>
          </tr>
        `;
      }).join('');
      
      countSpan.textContent = `ì´ ${allSelectionsData.length}ê°œ ì¤‘ ${filteredSelectionsData.length}ê°œ í‘œì‹œ`;
    }
    
    // í™•ì •ëœ ë°°ì •ì—ì„œ ì‚¬ìš©ëœ ëª¨ë“  ê¸°ì—…ëª… ëª©ë¡
    let confirmedCompanyNames = [];
    async function loadConfirmedAssignment() {
      try {
        const response = await fetch('/api/kidp2025/meetup/assignments/confirmed');
        if (!response.ok) {
          throw new Error('í™•ì •ëœ ë°°ì • ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
        }
        const data = await response.json();
        const infoBox = document.getElementById('confirmedInfo');
        const versionSpan = document.getElementById('confirmedVersion');
        const timeSpan = document.getElementById('confirmedTime');

        if (infoBox && versionSpan && timeSpan) {
          if (data.success && data.version) {
            infoBox.style.display = 'block';
            versionSpan.textContent = `ë²„ì „: ${data.version.version || '-'}`;
            timeSpan.textContent = `í™•ì • ì‹œê°„: ${data.version.confirmedAt || '-'}`;
          } else {
            infoBox.style.display = 'none';
            versionSpan.textContent = 'ë²„ì „: -';
            timeSpan.textContent = 'í™•ì • ì‹œê°„: -';
          }
        }
      } catch (error) {
        console.warn('í™•ì • ë°°ì • ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
        const infoBox = document.getElementById('confirmedInfo');
        if (infoBox) infoBox.style.display = 'none';
      }
    }
    
    // ë…¸ì‡¼ ì²˜ë¦¬ ëª¨ë‹¬ ì—´ê¸°
    async function openNoShowModal() {
      // í™•ì •ëœ ë°°ì •ì—ì„œ ì‚¬ìš©ëœ ê¸°ì—…ëª… ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
      try {
        const response = await fetch('/api/kidp2025/meetup/assignments');
        if (response.ok) {
          const data = await response.json();
          if (data.success && data.assignments) {
            const companySet = new Set();
            data.assignments.forEach(a => {
              if (a.techCompany) companySet.add(a.techCompany);
              if (a.designCompany) companySet.add(a.designCompany);
            });
            confirmedCompanyNames = Array.from(companySet).sort();
          }
        }
      } catch (error) {
        console.error('í™•ì •ëœ ë°°ì • ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
      }
      
      document.getElementById('noShowModal').style.display = 'block';
      document.getElementById('noShowCompanyName').value = '';
      document.getElementById('noShowCompanySuggestions').style.display = 'none';
      setTimeout(() => document.getElementById('noShowCompanyName').focus(), 100);
    }
    
    // ë…¸ì‡¼ ì²˜ë¦¬ ëª¨ë‹¬ ë‹«ê¸°
    function closeNoShowModal() {
      document.getElementById('noShowModal').style.display = 'none';
      document.getElementById('noShowCompanyName').value = '';
      document.getElementById('noShowCompanySuggestions').style.display = 'none';
    }

    // ìˆ˜ë™ ë°°ì • ì…ë ¥ ëª¨ë‹¬ ì—´ê¸°
    function openManualAssignmentModal() {
      const modal = document.getElementById('manualAssignmentModal');
      if (!modal) return;
      
      modal.style.display = 'block';
      
      setTimeout(() => {
        const table = ensureManualAssignmentTable();
        if (!table) return;
        
        if (isManualGridEmpty(table)) {
          if (assignmentResult && assignmentResult.assignments && assignmentResult.assignments.length > 0) {
            table.setData(assignmentResult.assignments.map(transformAssignmentForGrid));
          } else {
            table.setData(getManualAssignmentDefaultRows());
          }
        }
        
        table.redraw(true);
      }, 0);
    }

    function closeManualAssignmentModal() {
      const modal = document.getElementById('manualAssignmentModal');
      if (modal) {
        modal.style.display = 'none';
      }
    }

    function applyManualAssignment() {
      const table = ensureManualAssignmentTable();
      if (!table) return;
      
      const rawRows = table.getData();
      const rows = rawRows.filter(row => {
        return (
          (row.round !== '' && row.round !== undefined && row.round !== null) ||
          (row.table !== '' && row.table !== undefined && row.table !== null) ||
          (row.techCompany && row.techCompany.toString().trim() !== '') ||
          (row.designCompany && row.designCompany.toString().trim() !== '') ||
          (row.score !== '' && row.score !== undefined && row.score !== null)
        );
      });
      
      if (!rows.length) {
        showNotification('ì…ë ¥ëœ í–‰ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const assignments = [];
      let maxRound = 0;
      let maxTable = 0;
      
      try {
        rows.forEach((row, index) => {
          const round = parseInt((row.round ?? '').toString().trim(), 10);
          if (isNaN(round)) {
            throw new Error(`${index + 1}í–‰ì˜ ë¼ìš´ë“œ ê°’ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.`);
          }
          
          const tableNum = parseInt((row.table ?? '').toString().trim(), 10);
          if (isNaN(tableNum)) {
            throw new Error(`${index + 1}í–‰ì˜ í…Œì´ë¸” ë²ˆí˜¸ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.`);
          }
          
          const techRaw = (row.techCompany || '').toString().trim();
          const designRaw = (row.designCompany || '').toString().trim();
          
          if (!techRaw || !designRaw) {
            throw new Error(`${index + 1}í–‰ì˜ ê¸°ì—… ì •ë³´ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.`);
          }
          
          const techInfo = resolveCompanyInput(techRaw, 'tech');
          const designInfo = resolveCompanyInput(designRaw, 'design');
          
          const scoreValue = row.score !== undefined && row.score !== null && row.score !== ''
            ? Number(row.score)
            : 0;
          
          assignments.push({
            round,
            table: tableNum,
            techCompany: techRaw,
            techEmail: (techInfo && techInfo.email) || '',
            designCompany: designRaw,
            designEmail: (designInfo && designInfo.email) || '',
            score: isNaN(scoreValue) ? 0 : scoreValue
          });

          if (techInfo && techInfo.email && techInfo.name) {
            userCompanyMap[techInfo.email] = techInfo.name;
          }
          if (designInfo && designInfo.email && designInfo.name) {
            userCompanyMap[designInfo.email] = designInfo.name;
          }
          
          maxRound = Math.max(maxRound, round);
          maxTable = Math.max(maxTable, tableNum);
        });
      } catch (error) {
        console.error('ìˆ˜ë™ ë°°ì • ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', error);
        showNotification(error.message || 'ìˆ˜ë™ ë°°ì • ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        return;
      }
      
      if (assignments.length === 0) {
        showNotification('ìœ íš¨í•œ í–‰ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë°ì´í„°ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.');
        return;
      }
      
      const manualResult = {
        assignments,
        assigned: [],
        unassigned: [],
        noMatchingTeams: { tech: [], design: [] },
        roundCount: maxRound || (parseInt(document.getElementById('roundCount').value, 10) || 1),
        tableCount: maxTable || (parseInt(document.getElementById('tableCount').value, 10) || 1),
        assignmentMode: 'manual'
      };
      
      assignmentResult = manualResult;
      window.assignmentResult = manualResult;
      renderAssignmentResult(manualResult);
      markAssignmentDirty();
      
      document.getElementById('assignmentResult').style.display = 'block';
      document.getElementById('confirmAssignmentBtn').style.display = 'inline-block';
      document.getElementById('resetAssignmentBtn').style.display = 'inline-block';
      document.getElementById('clearAssignmentBtn').style.display = 'inline-block';
      document.getElementById('noShowBtn').style.display = 'inline-block';
      
      closeManualAssignmentModal();
      showNotification(`ìˆ˜ë™ ë°°ì • ${assignments.length}ê±´ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤.`);
    }
    
    // ê¸°ì—…ëª… ìë™ì™„ì„± í•„í„°ë§
    function filterCompanyNames(query) {
      const suggestionsDiv = document.getElementById('noShowCompanySuggestions');
      if (!query || query.trim().length === 0) {
        suggestionsDiv.style.display = 'none';
        return;
      }
      
      const filtered = confirmedCompanyNames.filter(name => 
        name.toLowerCase().includes(query.toLowerCase())
      );
      
      if (filtered.length === 0) {
        suggestionsDiv.style.display = 'none';
        return;
      }
      
    suggestionsDiv.innerHTML = filtered.slice(0, 10).map(name => `
      <div 
        class="suggestion-item" 
        style="padding: 10px; cursor: pointer; border-bottom: 1px solid #2a2a2a; transition: background 0.2s;"
        data-name="${escapeHtml(name).replace(/"/g, '&quot;')}"
        onmouseover="this.style.background='#2a2a2a'"
        onmouseout="this.style.background='transparent'"
      >
        ${escapeHtml(name)}
      </div>
    `).join('');
    suggestionsDiv.style.display = 'block';
    suggestionsDiv.querySelectorAll('.suggestion-item').forEach(item => {
      item.addEventListener('mousedown', (event) => {
        event.preventDefault();
        selectCompanyName(item.textContent.trim());
      });
    });
    }
    
    // ê¸°ì—…ëª… ì„ íƒ
    function selectCompanyName(name) {
      document.getElementById('noShowCompanyName').value = name;
      document.getElementById('noShowCompanySuggestions').style.display = 'none';
    }
    
    // ë…¸ì‡¼ ì²˜ë¦¬ ì‹¤í–‰
    async function processNoShow() {
      const companyName = document.getElementById('noShowCompanyName').value.trim();
      
      if (!companyName) {
        showNotification('ê¸°ì—…ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      let confirmMessage = `í™•ì •ëœ ë°°ì •ì—ì„œ ë‹¤ìŒ ê¸°ì—…ì„ ë…¸ì‡¼ë¡œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê¸°ì—…ëª…: ${companyName}\n\nì´ ê¸°ì—…ì´ í¬í•¨ëœ ëª¨ë“  ë°°ì •ì´ ì œì™¸ë©ë‹ˆë‹¤.\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
      
      if (!confirm(confirmMessage)) {
        return;
      }
      
      try {
        const response = await fetch('/api/kidp2025/meetup/assignments/noshow', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ companyName: companyName }),
        });
        
        if (response.ok) {
          const data = await response.json();
          showNotification(`ë…¸ì‡¼ ì²˜ë¦¬ ì™„ë£Œ: ${companyName}ì´(ê°€) í¬í•¨ëœ ë°°ì •ì´ ì œì™¸ë˜ì—ˆìŠµë‹ˆë‹¤.`);
          closeNoShowModal();
          
          // í™•ì •ëœ ë°°ì • ë‹¤ì‹œ ë¡œë“œ
          await loadConfirmedAssignment();
        } else {
          const error = await response.json();
          showNotification(`ë…¸ì‡¼ ì²˜ë¦¬ ì‹¤íŒ¨: ${error.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
        }
      } catch (error) {
        console.error('ë…¸ì‡¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
        showNotification('ë…¸ì‡¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    // ë°©ì‹ 4: ì ì€ ê·¸ë£¹ ì „ì²´ ë¼ìš´ë“œ ë°°ì • (Half-Reset Round Robin - ì ìˆ˜ ê¸°ë°˜)
    function assignRoundsBySmallerGroup(matchings, roundCount, tableCount) {
      const engine = createAssignmentEngine(matchings, roundCount, tableCount);
      if (!engine) {
        return null;
      }

      const {
        rounds,
        allTechs,
        allDesigns,
        assignPair,
        pickDesignForTech,
        pickTechForDesign,
        roundDesignUsed,
        hasRoundCapacity,
        finalize
      } = engine;

      function assignRoundTechFirst(round, phaseLabel) {
        if (!rounds.includes(round)) return;
        for (const tech of allTechs) {
          if (!hasRoundCapacity(round)) break;
          if (engine.techSchedule[tech.id][round]) continue;
          const designId = pickDesignForTech(tech.id, round, null);
          if (designId) {
            assignPair(tech.id, designId, round, phaseLabel);
          }
        }
      }

      function assignRoundDesignFirst(round, designIds, phaseLabel) {
        if (!rounds.includes(round)) return;
        for (const designId of designIds) {
          if (!hasRoundCapacity(round)) break;
          if (roundDesignUsed[round].has(designId)) continue;
          const techId = pickTechForDesign(designId, round);
          if (techId) {
            assignPair(techId, designId, round, phaseLabel);
          }
        }
      }

      function fillRoundWithTech(round, techList, allowedDesignSet, phaseLabel) {
        if (!rounds.includes(round)) return;
        for (const tech of techList) {
          if (!hasRoundCapacity(round)) break;
          if (engine.techSchedule[tech.id][round]) continue;
          const designId = pickDesignForTech(tech.id, round, allowedDesignSet);
          if (designId) {
            assignPair(tech.id, designId, round, phaseLabel);
          }
        }
      }

      assignRoundTechFirst(1, 'Round1-TechFirst');
      const r1Participants = new Set(roundDesignUsed[1] || []);

      const r2Targets = allDesigns.filter(design => !r1Participants.has(design.id));
      assignRoundDesignFirst(2, r2Targets.map(d => d.id), 'Round2-Recovery');
      const techWithoutR2 = allTechs.filter(tech => !(engine.techSchedule[tech.id] && engine.techSchedule[tech.id][2]));
      fillRoundWithTech(2, techWithoutR2, r1Participants, 'Round2-Fill');

      assignRoundTechFirst(3, 'Round3-TechFirst');
      const r3Participants = new Set(roundDesignUsed[3] || []);

      const r4Targets = allDesigns.filter(design => !r3Participants.has(design.id));
      assignRoundDesignFirst(4, r4Targets.map(d => d.id), 'Round4-Recovery');
      const techWithoutR4 = allTechs.filter(tech => !(engine.techSchedule[tech.id] && engine.techSchedule[tech.id][4]));
      fillRoundWithTech(4, techWithoutR4, r3Participants, 'Round4-Fill');

      return finalize('HalfResetRR');
    }

    // ë°©ì‹ 1: ë§¤ì¹­ í¬ì¸íŠ¸ë¥¼ ìš°ì„ ìœ¼ë¡œ
    function assignRoundsByPriority(matchings, roundCount, tableCount, noMatchingTeams) {
      const engine = createAssignmentEngine(matchings, roundCount, tableCount);
      if (!engine) return null;

      const normalizedMatches = [...engine.cleanMatchings].sort((a, b) => (b.totalScore || 0) - (a.totalScore || 0));

      for (const round of engine.rounds) {
        const usedTech = new Set();
        const usedDesign = new Set();

        for (const match of normalizedMatches) {
          const techId = match.techId;
          const designId = match.designId;
          if (!techId || !designId) continue;
          if (usedTech.has(techId) || usedDesign.has(designId)) continue;
          if (!engine.hasRoundCapacity(round)) break;
          if (!engine.isSlotFree(techId, designId, round)) continue;

          engine.assignPair(techId, designId, round, `Priority-R${round}`);
          usedTech.add(techId);
          usedDesign.add(designId);
        }
      }

      return engine.finalize('Priority');
    }

    // ë°©ì‹ 2: ì ì–´ë„ 1ê°œ ì´ìƒì˜ ë°‹ì—…ì„ ë³´ì¥í•˜ê¸°
    function assignRoundsGuarantee1(matchings, roundCount, tableCount, noMatchingTeams) {
      const engine = createAssignmentEngine(matchings, roundCount, tableCount);
      if (!engine) return null;

      const normalizedMatches = [...engine.cleanMatchings].sort((a, b) => (b.totalScore || 0) - (a.totalScore || 0));
      const techCounts = {};
      const designCounts = {};
      engine.allTechs.forEach(t => { techCounts[t.id] = 0; });
      engine.allDesigns.forEach(d => { designCounts[d.id] = 0; });

      const needPhase = normalizedMatches.filter(match => {
        return techCounts[match.techId] === 0 || designCounts[match.designId] === 0;
      });

      for (const match of normalizedMatches) {
        const techId = match.techId;
        const designId = match.designId;
        if (!techId || !designId) continue;
        if (techCounts[techId] >= 1 && designCounts[designId] >= 1) continue;
        const round = engine.findAvailableRound(techId, designId);
        if (round !== null) {
          engine.assignPair(techId, designId, round, 'Guarantee1-Core');
          techCounts[techId] = (techCounts[techId] || 0) + 1;
          designCounts[designId] = (designCounts[designId] || 0) + 1;
        }
      }

      for (const match of normalizedMatches) {
        const techId = match.techId;
        const designId = match.designId;
        if (!techId || !designId) continue;
        const round = engine.findAvailableRound(techId, designId);
        if (round !== null) {
          engine.assignPair(techId, designId, round, 'Guarantee1-Fill');
        }
      }

      return engine.finalize('Guarantee1');
    }

    // ë°©ì‹ 3: ëª¨ë“  íŒ€ë“¤ì´ ë™ë“±í•˜ê²Œ XíšŒ ë°‹ì—…í•˜ê¸°
    function assignRoundsGuaranteeX(matchings, roundCount, tableCount, guaranteeRoundCount, noMatchingTeams) {
      const engine = createAssignmentEngine(matchings, roundCount, tableCount);
      if (!engine) return null;

      const target = Math.max(1, guaranteeRoundCount || 1);
      const normalizedMatches = [...engine.cleanMatchings].sort((a, b) => (b.totalScore || 0) - (a.totalScore || 0));
      const techCounts = {};
      const designCounts = {};
      engine.allTechs.forEach(t => { techCounts[t.id] = 0; });
      engine.allDesigns.forEach(d => { designCounts[d.id] = 0; });

      let progress = true;
      while (progress) {
        progress = false;
        for (const match of normalizedMatches) {
          const techId = match.techId;
          const designId = match.designId;
          if (!techId || !designId) continue;
          if (techCounts[techId] >= target || designCounts[designId] >= target) continue;
          const round = engine.findAvailableRound(techId, designId);
          if (round !== null) {
            engine.assignPair(techId, designId, round, `Guarantee${target}-Core`);
            techCounts[techId] += 1;
            designCounts[designId] += 1;
            progress = true;
          }
        }
      }

      const unmetTech = Object.entries(techCounts).filter(([, count]) => count < target).map(([id]) => id);
      const unmetDesign = Object.entries(designCounts).filter(([, count]) => count < target).map(([id]) => id);
      if (unmetTech.length > 0 || unmetDesign.length > 0) {
        console.warn(`[GuaranteeX] ëª©í‘œ ${target}íšŒë¥¼ ì¶©ì¡±í•˜ì§€ ëª»í•œ ê¸°ì—…ì´ ìˆìŠµë‹ˆë‹¤.`, { unmetTech, unmetDesign });
      }

      for (const match of normalizedMatches) {
        const techId = match.techId;
        const designId = match.designId;
        if (!techId || !designId) continue;
        const round = engine.findAvailableRound(techId, designId);
        if (round !== null) {
          engine.assignPair(techId, designId, round, `Guarantee${target}-Fill`);
        }
      }

      return engine.finalize(`Guarantee${target}`);
    }
// HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // ë°‹ì—… ì‹ ì²­ ë°ì´í„° í•„í„°ë§
    function filterSelections() {
      const searchTerm = document.getElementById('selectionsSearch').value.toLowerCase();
      const listTypeFilter = document.getElementById('selectionsListTypeFilter').value;
      
      filteredSelectionsData = allSelectionsData.filter(selection => {
        const matchesSearch = !searchTerm || 
          selection.email.toLowerCase().includes(searchTerm) ||
          (selection.userCompany || '').toLowerCase().includes(searchTerm) ||
          (selection.priority1 || '').toLowerCase().includes(searchTerm) ||
          (selection.priority2 || '').toLowerCase().includes(searchTerm) ||
          (selection.priority3 || '').toLowerCase().includes(searchTerm) ||
          (selection.priority4 || '').toLowerCase().includes(searchTerm) ||
          (selection.priority5 || '').toLowerCase().includes(searchTerm) ||
          (selection.priority6 || '').toLowerCase().includes(searchTerm) ||
          (selection.priority7 || '').toLowerCase().includes(searchTerm);
        
        const matchesListType = !listTypeFilter || selection.listType === listTypeFilter;
        
        return matchesSearch && matchesListType;
      });
      
      // ì •ë ¬ ì ìš©
      if (selectionsSortColumn) {
        sortSelectionsData(selectionsSortColumn, selectionsSortDirection);
      }
      
      renderSelectionsTable();
    }
    
    // CSV ë‹¤ìš´ë¡œë“œ
    function exportSelectionsCSV() {
      window.location.href = '/api/kidp2025/meetup/selections/export';
    }
    
    // ë§¤ì¹­ ìš°ì„ ìˆœìœ„ ê´€ë ¨ ë³€ìˆ˜
    let allMatchingData = [];
    let filteredMatchingData = [];
    
    // ë§¤ì¹­ ìš°ì„ ìˆœìœ„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadMatchingData() {
      const tbody = document.getElementById('matchingTableBody');
      const countSpan = document.getElementById('matchingCount');
      
      tbody.innerHTML = '<tr><td colspan="8" style="padding: 40px; text-align: center; color: #a0a0a0;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
      countSpan.textContent = 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
      
      try {
        // ì‚¬ìš©ì ì†Œì† ê¸°ì—… ì •ë³´ ë¨¼ì € ë¡œë“œ (CSVì—ì„œ)
        await loadUserCompanyMap();
        
        const response = await fetch('/api/kidp2025/meetup/matching');
        const data = await response.json();
        
        if (data.success && data.matchings) {
          // ì‚¬ìš©ì ì†Œì† ê¸°ì—…ëª… ì¶”ê°€ (CSVì—ì„œ ê°€ì ¸ì˜¨ ì •ë³´ ì‚¬ìš©)
          allMatchingData = data.matchings.map(matching => {
            // APIì—ì„œ ì´ë¯¸ ê¸°ì—…ëª…ì´ í¬í•¨ë˜ì–´ ìˆì§€ë§Œ, CSV ì •ë³´ë¡œ ë³´ì™„
            if (!matching.techCompany || matching.techCompany === matching.techEmail) {
              matching.techCompany = userCompanyMap[matching.techEmail.toLowerCase()] || matching.techCompany || matching.techEmail;
            }
            if (!matching.designCompany || matching.designCompany === matching.designEmail) {
              matching.designCompany = userCompanyMap[matching.designEmail.toLowerCase()] || matching.designCompany || matching.designEmail;
            }
            return matching;
          });
          
          filteredMatchingData = [...allMatchingData];
          filterMatching();
          countSpan.textContent = `ì´ ${allMatchingData.length}ê°œì˜ ë§¤ì¹­ ìŒ`;
          showNotification('ë§¤ì¹­ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
        } else {
          throw new Error(data.error || data.details || 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ë§¤ì¹­ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
        const errorMsg = error instanceof Error ? (error.message || String(error)) : String(error);
        tbody.innerHTML = `<tr><td colspan="8" style="padding: 40px; text-align: center; color: #DC2626;">ì˜¤ë¥˜: ${escapeHtml(errorMsg)}</td></tr>`;
        countSpan.textContent = 'ì˜¤ë¥˜ ë°œìƒ';
        showNotification('ë§¤ì¹­ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + errorMsg);
      }
    }
    
    // ë§¤ì¹­ ìš°ì„ ìˆœìœ„ í…Œì´ë¸” ë Œë”ë§
    function renderMatchingTable() {
      const tbody = document.getElementById('matchingTableBody');
      const countSpan = document.getElementById('matchingCount');
      
      if (filteredMatchingData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" style="padding: 40px; text-align: center; color: #a0a0a0;">ë§¤ì¹­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        countSpan.textContent = 'ë§¤ì¹­ ë°ì´í„° ì—†ìŒ';
        return;
      }
      
      tbody.innerHTML = filteredMatchingData.map((matching, index) => {
        const rank = index + 1;
        const totalScore = matching.totalScore;
        const scoreColor = totalScore >= 10 ? '#10B981' : totalScore >= 7 ? '#3B82F6' : totalScore >= 4 ? '#F59E0B' : '#EF4444';
        
        return `
          <tr style="border-bottom: 1px solid #2a2a2a; transition: background 0.2s;" 
              onmouseover="this.style.background='#2a2a2a'" 
              onmouseout="this.style.background='transparent'">
            <td style="padding: 12px; text-align: center; color: #DC2626; font-weight: 700; font-size: 16px;">${rank}</td>
            <td style="padding: 12px; color: #ffffff; font-weight: 600;">${escapeHtml(matching.techCompany)}</td>
            <td style="padding: 12px; color: #ffffff; font-weight: 600;">${escapeHtml(matching.designCompany)}</td>
            <td style="padding: 12px; text-align: center; color: #3B82F6; font-weight: 600;">${matching.techToDesignScore}</td>
            <td style="padding: 12px; text-align: center; color: #10B981; font-weight: 600;">${matching.designToTechScore}</td>
            <td style="padding: 12px; text-align: center;">
              <span style="padding: 6px 12px; background: ${scoreColor}; color: #ffffff; border-radius: 6px; font-size: 16px; font-weight: 700;">
                ${totalScore}
              </span>
            </td>
            <td style="padding: 12px; text-align: center; color: #a0a0a0;">
              ${matching.techPriority ? `${matching.techPriority}ìˆœìœ„` : '-'}
            </td>
            <td style="padding: 12px; text-align: center; color: #a0a0a0;">
              ${matching.designPriority ? `${matching.designPriority}ìˆœìœ„` : '-'}
            </td>
          </tr>
        `;
      }).join('');
      
      countSpan.textContent = `ì´ ${allMatchingData.length}ê°œ ì¤‘ ${filteredMatchingData.length}ê°œ í‘œì‹œ`;
    }
    
    // ë§¤ì¹­ ë°ì´í„° í•„í„°ë§ ë° ì •ë ¬
    function filterMatching() {
      const searchTerm = document.getElementById('matchingSearch').value.toLowerCase();
      const sortBy = document.getElementById('matchingSortBy').value;
      const minScore = parseInt(document.getElementById('matchingMinScore').value) || 0;
      
      filteredMatchingData = allMatchingData.filter(matching => {
        const matchesSearch = !searchTerm || 
          matching.techCompany.toLowerCase().includes(searchTerm) ||
          matching.designCompany.toLowerCase().includes(searchTerm);
        
        const matchesMinScore = matching.totalScore >= minScore;
        
        return matchesSearch && matchesMinScore;
      });
      
      // ì •ë ¬
      filteredMatchingData.sort((a, b) => {
        switch (sortBy) {
          case 'score-desc':
            return b.totalScore - a.totalScore;
          case 'score-asc':
            return a.totalScore - b.totalScore;
          case 'tech-asc':
            return a.techCompany.localeCompare(b.techCompany, 'ko');
          case 'design-asc':
            return a.designCompany.localeCompare(b.designCompany, 'ko');
          default:
            return b.totalScore - a.totalScore;
        }
      });
      
      renderMatchingTable();
    }
    
    // ë§¤ì¹­ CSV ë‹¤ìš´ë¡œë“œ
    function exportMatchingCSV() {
      const headers = [
        'ìˆœìœ„',
        'ê¸°ìˆ ê¸°ì—…',
        'ë””ìì¸ê¸°ì—…',
        'ê¸°ìˆ â†’ë””ìì¸ ì ìˆ˜',
        'ë””ìì¸â†’ê¸°ìˆ  ì ìˆ˜',
        'ì´ì ',
        'ê¸°ìˆ ê¸°ì—… ì„ íƒ ìˆœìœ„',
        'ë””ìì¸ê¸°ì—… ì„ íƒ ìˆœìœ„'
      ];
      
      const csvRows = [headers.join(',')];
      
      filteredMatchingData.forEach((matching, index) => {
        const csvRow = [
          index + 1,
          `"${(matching.techCompany || '').replace(/"/g, '""')}"`,
          `"${(matching.designCompany || '').replace(/"/g, '""')}"`,
          matching.techToDesignScore,
          matching.designToTechScore,
          matching.totalScore,
          matching.techPriority || '',
          matching.designPriority || ''
        ];
        csvRows.push(csvRow.join(','));
      });
      
      const csvContent = csvRows.join('\n');
      const bom = '\uFEFF'; // UTF-8 BOM (Excel í˜¸í™˜)
      const blob = new Blob([bom + csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `matching_priority_${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showNotification('ë§¤ì¹­ ìš°ì„ ìˆœìœ„ CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
    
    // ë¼ìš´ë“œ ë°°ì • ê´€ë ¨ ë³€ìˆ˜
    let assignmentResult = null;
    let manualAssignmentTable = null;
    
    function getManualAssignmentDefaultRows(count = 10) {
      return Array.from({ length: count }).map(() => ({
        round: '',
        table: '',
        techCompany: '',
        designCompany: '',
        score: ''
      }));
    }
    
    function ensureManualAssignmentTable() {
      if (manualAssignmentTable) {
        return manualAssignmentTable;
      }
      
      const gridElement = document.getElementById('manualAssignmentGrid');
      if (!gridElement) {
        return null;
      }
      
      if (typeof Tabulator === 'undefined') {
        console.error('Tabulator ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        showNotification('ìˆ˜ë™ ì…ë ¥ í‘œë¥¼ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ ì£¼ì„¸ìš”.');
        return null;
      }
      
      manualAssignmentTable = new Tabulator(gridElement, {
        layout: 'fitColumns',
        height: 360,
        selectable: true,
        clipboard: true,
        clipboardPasteParser: 'table',
        clipboardPasteAction: 'replace',
        placeholder: 'í–‰ì„ ì¶”ê°€í•˜ê±°ë‚˜ ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”.',
        columnDefaults: {
          headerSort: false,
          hozAlign: 'left',
          vertAlign: 'middle'
        },
        columns: [
          { title: 'ë¼ìš´ë“œ', field: 'round', width: 90, hozAlign: 'center', editor: 'number' },
          { title: 'í…Œì´ë¸”', field: 'table', width: 100, hozAlign: 'center', editor: 'number' },
          { title: 'ê¸°ìˆ ê¸°ì—…', field: 'techCompany', editor: 'input', minWidth: 220 },
          { title: 'ë””ìì¸ê¸°ì—…', field: 'designCompany', editor: 'input', minWidth: 220 },
          { title: 'ë§¤ì¹­ì ìˆ˜', field: 'score', width: 110, hozAlign: 'center', editor: 'number' }
        ]
      });
      
      manualAssignmentTable.setData(getManualAssignmentDefaultRows());
      return manualAssignmentTable;
    }
    
    function isManualGridEmpty(table) {
      if (!table) return true;
      const data = table.getData();
      if (!data || data.length === 0) return true;
      return data.every(row => {
        const values = [row.round, row.table, row.techCompany, row.designCompany, row.score];
        return values.every(value => value === '' || value === null || value === undefined);
      });
    }
    
    function addManualGridRow() {
      const table = ensureManualAssignmentTable();
      if (!table) {
        showNotification('í‘œë¥¼ ì´ˆê¸°í™”í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ ì£¼ì„¸ìš”.');
        return;
      }
      table.addRow({});
    }
    
    function removeManualGridRows() {
      const table = ensureManualAssignmentTable();
      if (!table) {
        showNotification('í‘œë¥¼ ì´ˆê¸°í™”í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ ì£¼ì„¸ìš”.');
        return;
      }
      const selectedRows = table.getSelectedRows();
      if (!selectedRows || selectedRows.length === 0) {
        showNotification('ì‚­ì œí•  í–‰ì„ ì„ íƒí•˜ì„¸ìš”.');
        return;
      }
      selectedRows.forEach(row => row.delete());
    }
    
    function clearManualGridRows() {
      const table = ensureManualAssignmentTable();
      if (!table) {
        showNotification('í‘œë¥¼ ì´ˆê¸°í™”í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ ì£¼ì„¸ìš”.');
        return;
      }
      table.deselectRow();
      table.setData(getManualAssignmentDefaultRows());
    }

    function resolveCompanyInput(rawValue, type) {
      const raw = (rawValue || '').toString().trim();
      if (!raw) return null;
      
      const lookupMaps = type === 'tech' ? techCompanyEmailMapByName : designCompanyEmailMapByName;
      const companyList = type === 'tech' ? techCompanyList : designCompanyList;
      
      if (raw.includes('@')) {
        const email = raw.toLowerCase();
        const name = getCompanyNameByEmail(email, raw) || companyList.find(entry => entry.email === email)?.name || raw;
        return { email, name };
      }
      
      const normalized = normalizeCompanyKey(raw);
      const emailFromName = lookupMaps[normalized];
      if (!emailFromName) {
        return null;
      }
      const canonicalName = companyList.find(entry => entry.email === emailFromName)?.name || raw;
      return { email: emailFromName, name: canonicalName };
    }
    
    function transformAssignmentForGrid(assignment) {
      if (!assignment) return {};
      return {
        round: assignment.round ?? '',
        table: assignment.table ?? '',
        techCompany: assignment.techCompany || getCompanyNameByEmail(assignment.techEmail, '') || assignment.techEmail || '',
        designCompany: assignment.designCompany || getCompanyNameByEmail(assignment.designEmail, '') || assignment.designEmail || '',
        score: assignment.score ?? ''
      };
    }
    
    // guaranteeX ë¼ë²¨ ì—…ë°ì´íŠ¸ (ì‚¬ìš©í•˜ì§€ ì•Šì§€ë§Œ ì¼ê´€ì„±ì„ ìœ„í•´)
    function updateGuaranteeXLabel() {
      // í•„ìš”ì‹œ êµ¬í˜„
    }
    
    // ê¸°ìˆ ê¸°ì—… ê³ ì • ì¢Œì„ ì •ë³´ ë¡œë“œ (ì´ë©”ì¼ -> í…Œì´ë¸” ë²ˆí˜¸ ë§¤í•‘)
    let techFixedSeatMap = {}; // techEmail -> tableNumber
    let designFixedSeatMap = {}; // designEmail -> tableNumber
    let techCompanyList = []; // ê¸°ìˆ ê¸°ì—… ëª©ë¡
    let designCompanyList = []; // ë””ìì¸ê¸°ì—… ëª©ë¡
    let techCompanyEmailMapByName = {};
    let designCompanyEmailMapByName = {};
    
    function normalizeCompanyKey(value) {
      return value ? value.toString().trim().toLowerCase().replace(/\s+/g, ' ') : '';
    }
    
    function buildCompanyEmailLookup() {
      techCompanyEmailMapByName = {};
      designCompanyEmailMapByName = {};
      
      techCompanyList.forEach(entry => {
        const key = normalizeCompanyKey(entry.name);
        if (key && entry.email) {
          techCompanyEmailMapByName[key] = entry.email;
        }
      });
      
      designCompanyList.forEach(entry => {
        const key = normalizeCompanyKey(entry.name);
        if (key && entry.email) {
          designCompanyEmailMapByName[key] = entry.email;
        }
      });
    }
    
    // ê³ ì • ì¢Œì„ ì„¤ì •ì„ ìœ„í•œ ê¸°ì—… ëª©ë¡ ë¡œë“œ
    async function loadCompanyLists() {
      try {
        // ê¸°ìˆ ê¸°ì—… ëª©ë¡ ë¡œë“œ
        const techRes = await fetch(TECH_CSV_URL);
        const techText = await techRes.text();
        const techLines = techText.split(/\r?\n/).filter(line => line.trim());
        
        if (techLines.length >= 2) {
          const headers = parseCSVLine(techLines[0]);
          const userEmailIdx = headers.findIndex(h => h === 'ì‚¬ìš©ì ì´ë¦„' || h === 'ì´ë©”ì¼');
          const companyNameIdx = headers.findIndex(h => h === 'ê¸°ì—…ëª…' || h === 'ë©˜í† ëª…' || h === 'ê¸°ìˆ ê¸°ì—…ëª…');
          
          techCompanyList = [];
          for (let i = 1; i < techLines.length; i++) {
            const values = parseCSVLine(techLines[i]);
            if (values.length <= Math.max(userEmailIdx, companyNameIdx)) continue;
            
            const email = (values[userEmailIdx] || '').toLowerCase().trim();
            const companyName = (values[companyNameIdx] || '').trim();
            
            // ì‚¬ìš©ì ì´ë¦„ê³¼ ê¸°ì—…ëª…ì´ ëª¨ë‘ ìˆì–´ì•¼ í•¨
            if (email && companyName) {
              techCompanyList.push({
                email: email,
                name: companyName
              });
            }
          }
        }
        
        // ë””ìì¸ê¸°ì—… ëª©ë¡ ë¡œë“œ
        const designRes = await fetch(DESIGN_CSV_URL);
        const designText = await designRes.text();
        const designLines = designText.split(/\r?\n/).filter(line => line.trim());
        
        if (designLines.length >= 2) {
          const headers = parseCSVLine(designLines[0]);
          const userEmailIdx = headers.findIndex(h => h === 'ì‚¬ìš©ì ì´ë¦„' || h === 'ì´ë©”ì¼');
          const companyNameIdx = headers.findIndex(h => h === 'ê¸°ì—…ëª…' || h === 'ìŠ¤íƒ€íŠ¸ì—…' || h === 'ë””ìì¸ì „ë¬¸ê¸°ì—…');
          
          designCompanyList = [];
          for (let i = 1; i < designLines.length; i++) {
            const values = parseCSVLine(designLines[i]);
            if (values.length <= Math.max(userEmailIdx, companyNameIdx)) continue;
            
            const email = (values[userEmailIdx] || '').toLowerCase().trim();
            const companyName = (values[companyNameIdx] || '').trim();
            
            // ì‚¬ìš©ì ì´ë¦„ê³¼ ê¸°ì—…ëª…ì´ ëª¨ë‘ ìˆì–´ì•¼ í•¨
            if (email && companyName) {
              designCompanyList.push({
                email: email,
                name: companyName
              });
            }
          }
        }
        
        // ê³ ì • ì¢Œì„ ì„¤ì • ì„¹ì…˜ í‘œì‹œ ì—¬ë¶€ í™•ì¸
        buildCompanyEmailLookup();
        checkFixedSeatSection();
      } catch (error) {
        console.error('ê¸°ì—… ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    
    // ê³ ì • ì¢Œì„ ì„¤ì • ì„¹ì…˜ í‘œì‹œ ì—¬ë¶€ í™•ì¸
    function checkFixedSeatSection() {
      const roundCount = parseInt(document.getElementById('roundCount').value) || 3;
      const tableCount = parseInt(document.getElementById('tableCount').value) || 10;
      const fixedSeatSection = document.getElementById('fixedSeatSection');
      
      // ìš”ì†Œê°€ ì—†ìœ¼ë©´ í•¨ìˆ˜ ì¢…ë£Œ
      if (!fixedSeatSection) {
        return;
      }
      
      const techCount = techCompanyList.length;
      const designCount = designCompanyList.length;
      
      let canFixTech = techCount > 0 && techCount < tableCount;
      let canFixDesign = designCount > 0 && designCount < tableCount;
      
      if (canFixTech || canFixDesign) {
        fixedSeatSection.style.display = 'block';
        
        let infoText = '';
        if (canFixTech && canFixDesign) {
          infoText = `ê¸°ìˆ ê¸°ì—…: ${techCount}ê°œ (í…Œì´ë¸” ${tableCount}ê°œ) | ë””ìì¸ì „ë¬¸ê¸°ì—…: ${designCount}ê°œ (í…Œì´ë¸” ${tableCount}ê°œ)`;
        } else if (canFixTech) {
          infoText = `ê¸°ìˆ ê¸°ì—…: ${techCount}ê°œ (í…Œì´ë¸” ${tableCount}ê°œ)`;
        } else if (canFixDesign) {
          infoText = `ë””ìì¸ì „ë¬¸ê¸°ì—…: ${designCount}ê°œ (í…Œì´ë¸” ${tableCount}ê°œ)`;
        }
        const fixedSeatInfo = document.getElementById('fixedSeatInfo');
        if (fixedSeatInfo) {
          fixedSeatInfo.textContent = infoText;
        }
      } else {
        fixedSeatSection.style.display = 'none';
      }
    }
    
    // ê³ ì • ì¢Œì„ ì„¤ì •í•  ê¸°ì—… ëª©ë¡ ë¡œë“œ
    function loadFixedSeatCompanies() {
      const groupSelect = document.getElementById('fixedSeatGroupSelect');
      const selectedGroup = groupSelect.value;
      const tableContainer = document.getElementById('fixedSeatTableContainer');
      const tableBody = document.getElementById('fixedSeatTableBody');
      const tableTitle = document.getElementById('fixedSeatTableTitle');
      
      if (!tableContainer || !tableBody || !tableTitle) {
        console.warn('ê³ ì • ì¢Œì„ í…Œì´ë¸” ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      if (!selectedGroup) {
        tableContainer.style.display = 'none';
        return;
      }
      
      const tableCount = parseInt(document.getElementById('tableCount').value) || 10;
      let companies = [];
      let fixedSeatMap = {};
      
      if (selectedGroup === 'tech') {
        companies = techCompanyList;
        fixedSeatMap = techFixedSeatMap;
        tableTitle.textContent = 'ê¸°ìˆ ê¸°ì—… ê³ ì • ì¢Œì„ ì„¤ì •';
      } else {
        companies = designCompanyList;
        fixedSeatMap = designFixedSeatMap;
        tableTitle.textContent = 'ë””ìì¸ì „ë¬¸ê¸°ì—… ê³ ì • ì¢Œì„ ì„¤ì •';
      }
      
      tableBody.innerHTML = '';
      
      companies.forEach((company, index) => {
        const row = document.createElement('tr');
        const currentTable = fixedSeatMap[company.email] || '';
        
        row.innerHTML = `
          <td style="padding: 12px; border-bottom: 1px solid #3a3a3a; color: #ffffff;">${index + 1}</td>
          <td style="padding: 12px; border-bottom: 1px solid #3a3a3a; color: #ffffff;">${escapeHtml(company.name)}</td>
          <td style="padding: 12px; border-bottom: 1px solid #3a3a3a;">
            <input 
              type="number" 
              class="fixed-seat-input" 
              data-email="${company.email}"
              data-group="${selectedGroup}"
              min="1" 
              max="${tableCount}"
              value="${currentTable}"
              placeholder="í…Œì´ë¸” ë²ˆí˜¸"
              style="width: 100%; padding: 8px; background: #2a2a2a; border: 1px solid #3a3a3a; border-radius: 6px; color: #ffffff; font-size: 14px;"
            />
          </td>
        `;
        tableBody.appendChild(row);
      });
      
      tableContainer.style.display = 'block';
    }
    
    // ê³ ì • ì¢Œì„ ì €ì¥
    function saveFixedSeats() {
      const groupSelect = document.getElementById('fixedSeatGroupSelect');
      const selectedGroup = groupSelect.value;
      
      if (!selectedGroup) {
        showNotification('ê·¸ë£¹ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const inputs = document.querySelectorAll(`.fixed-seat-input[data-group="${selectedGroup}"]`);
      const tableCount = parseInt(document.getElementById('tableCount').value) || 10;
      const usedTables = new Set();
      const duplicateTables = [];
      
      // ì…ë ¥ê°’ ê²€ì¦ ë° ì¤‘ë³µ í™•ì¸
      inputs.forEach(input => {
        const tableNum = parseInt(input.value);
        if (tableNum && tableNum >= 1 && tableNum <= tableCount) {
          if (usedTables.has(tableNum)) {
            duplicateTables.push(tableNum);
          } else {
            usedTables.add(tableNum);
          }
        }
      });
      
      if (duplicateTables.length > 0) {
        showNotification(`ì¤‘ë³µëœ í…Œì´ë¸” ë²ˆí˜¸ê°€ ìˆìŠµë‹ˆë‹¤: ${duplicateTables.join(', ')}`);
        return;
      }
      
      // ê³ ì • ì¢Œì„ ë§µ ì—…ë°ì´íŠ¸
      if (selectedGroup === 'tech') {
        techFixedSeatMap = {};
        inputs.forEach(input => {
          const email = input.getAttribute('data-email');
          const tableNum = parseInt(input.value);
          if (tableNum && tableNum >= 1 && tableNum <= tableCount) {
            techFixedSeatMap[email] = tableNum;
          }
        });
        showNotification(`ê¸°ìˆ ê¸°ì—… ê³ ì • ì¢Œì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (${Object.keys(techFixedSeatMap).length}ê°œ)`);
      } else {
        designFixedSeatMap = {};
        inputs.forEach(input => {
          const email = input.getAttribute('data-email');
          const tableNum = parseInt(input.value);
          if (tableNum && tableNum >= 1 && tableNum <= tableCount) {
            designFixedSeatMap[email] = tableNum;
          }
        });
        showNotification(`ë””ìì¸ì „ë¬¸ê¸°ì—… ê³ ì • ì¢Œì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (${Object.keys(designFixedSeatMap).length}ê°œ)`);
      }
    }
    
    async function loadTechFixedSeats() {
      try {
        const techRes = await fetch(TECH_CSV_URL);
        const techText = await techRes.text();
        const techLines = techText.split(/\r?\n/).filter(line => line.trim());
        
        if (techLines.length < 2) {
          console.warn('ê¸°ìˆ ê¸°ì—… CSV ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const headers = parseCSVLine(techLines[0]);
        const userEmailIdx = headers.findIndex(h => h === 'ì‚¬ìš©ì ì´ë¦„' || h === 'ì´ë©”ì¼');
        const companyNameIdx = headers.findIndex(h => h === 'ê¸°ì—…ëª…' || h === 'ë©˜í† ëª…' || h === 'ê¸°ìˆ ê¸°ì—…ëª…');
        const fixedSeatIdx = headers.findIndex(h => h === 'ì§€ì •ì„');
        
        techFixedSeatMap = {};
        
        if (userEmailIdx >= 0 && fixedSeatIdx >= 0) {
          for (let i = 1; i < techLines.length; i++) {
            const values = parseCSVLine(techLines[i]);
            if (values.length <= Math.max(userEmailIdx, fixedSeatIdx)) continue;
            
            const email = (values[userEmailIdx] || '').toLowerCase().trim();
            const fixedSeat = (values[fixedSeatIdx] || '').trim();
            
            if (email && fixedSeat && fixedSeat !== 'ë¯¸ì •') {
              // ì§€ì •ì„ì´ ìˆ«ìì¸ ê²½ìš° ê·¸ëŒ€ë¡œ ì‚¬ìš©
              const tableNum = parseInt(fixedSeat);
              if (!isNaN(tableNum) && tableNum > 0) {
                techFixedSeatMap[email] = tableNum;
              }
            }
          }
        }
        
        console.log('ê¸°ìˆ ê¸°ì—… ê³ ì • ì¢Œì„ ë¡œë“œ ì™„ë£Œ:', Object.keys(techFixedSeatMap).length, 'ê°œ');
      } catch (error) {
        console.error('ê¸°ìˆ ê¸°ì—… ê³ ì • ì¢Œì„ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    
    // ë§¤ì¹­ë˜ì§€ ì•Šì€ ê¸°ì—… ì°¾ê¸°
    function findNoMatchingTeams(matchings = []) {
      const normalize = (value) => (value || '').toLowerCase().trim();
      const matchedTech = new Set();
      const matchedDesign = new Set();

      (matchings || []).forEach(match => {
        const techEmail = normalize(match.techEmail || match.techId || match.tech_email);
        if (techEmail) matchedTech.add(techEmail);
        const designEmail = normalize(match.designEmail || match.designId || match.design_email);
        if (designEmail) matchedDesign.add(designEmail);
      });

      const techNoMatches = [];
      const designNoMatches = [];

      const addIfUnmatched = (type, emailRaw, companyName) => {
        const email = normalize(emailRaw);
        if (!email) return;
        const isMatched = type === 'tech' ? matchedTech.has(email) : matchedDesign.has(email);
        if (isMatched) return;
        const targetList = type === 'tech' ? techNoMatches : designNoMatches;
        if (targetList.some(item => item.email === email)) return;

        targetList.push({
          email,
          companyName: companyName || userCompanyMap[email] || email
        });
      };

      if (allSelectionsData && allSelectionsData.length > 0) {
        allSelectionsData.forEach(selection => {
          const email = selection.email || selection.user_email || selection.userEmail;
          const companyName = selection.userCompany || selection.companyName || selection.company_name;
          if (selection.listType === 'design') {
            addIfUnmatched('tech', email, companyName);
          } else if (selection.listType === 'tech') {
            addIfUnmatched('design', email, companyName);
          }
        });
      }

      if (techCompanyList && techCompanyList.length > 0) {
        techCompanyList.forEach(company => addIfUnmatched('tech', company.email, company.name));
      }
      if (designCompanyList && designCompanyList.length > 0) {
        designCompanyList.forEach(company => addIfUnmatched('design', company.email, company.name));
      }

      return {
        tech: techNoMatches,
        design: designNoMatches
      };
    }

    function createAssignmentEngine(matchings, roundCount, tableCount) {
      const TOTAL_ROUNDS = Math.max(1, roundCount || 1);
      const rounds = Array.from({ length: TOTAL_ROUNDS }, (_, idx) => idx + 1);
      const normalizeId = (value) => (value || '').trim().toLowerCase();

      const ensureCompany = (map, rawId, rawName) => {
        const id = normalizeId(rawId);
        if (!id) return;
        const displayName = rawName && rawName.trim().length > 0
          ? rawName.trim()
          : (userCompanyMap[id] || rawId || id);
        if (!map.has(id)) {
          map.set(id, { id, name: displayName });
        } else if ((!map.get(id).name || map.get(id).name === id) && displayName && displayName !== id) {
          map.set(id, { id, name: displayName });
        }
      };

      const techMap = new Map();
      const designMap = new Map();

      techCompanyList.forEach(company => ensureCompany(techMap, company.email, company.name));
      designCompanyList.forEach(company => ensureCompany(designMap, company.email, company.name));
      matchings.forEach(match => {
        ensureCompany(techMap, match.techEmail, match.techCompany);
        ensureCompany(designMap, match.designEmail, match.designCompany);
      });

      if (techMap.size === 0 || designMap.size === 0) {
        showNotification('ê¸°ì—… ë°ì´í„°ê°€ ë¶€ì¡±í•˜ì—¬ ë°°ì •ì„ ì§„í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        console.warn('[AssignmentEngine] ê¸°ì—… ëª©ë¡ ë¶€ì¡±ìœ¼ë¡œ ë°°ì •ì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.');
        return null;
      }

      const allTechs = Array.from(techMap.values());
      const allDesigns = Array.from(designMap.values());
      const techOrderMap = new Map();
      allTechs.forEach((tech, index) => techOrderMap.set(tech.id, index + 1));

      const cleanMatchings = matchings.map(match => {
        const techId = normalizeId(match.techId || match.techEmail);
        const designId = normalizeId(match.designId || match.designEmail);
        return {
          ...match,
          techId,
          designId,
          totalScore: match.totalScore ?? 0
        };
      }).filter(match => techMap.has(match.techId) && designMap.has(match.designId));

      const scoreMap = {};
      const techPrefMap = new Map();
      const designPrefMap = new Map();
      const techNameByEmail = new Map();
      const designNameByEmail = new Map();

      cleanMatchings.forEach(match => {
        const key = `${match.techId}|${match.designId}`;
        scoreMap[key] = match.totalScore;
        if (!techPrefMap.has(match.techId)) techPrefMap.set(match.techId, []);
        techPrefMap.get(match.techId).push({ designId: match.designId, score: match.totalScore });
        if (!designPrefMap.has(match.designId)) designPrefMap.set(match.designId, []);
        designPrefMap.get(match.designId).push({ techId: match.techId, score: match.totalScore });
        if (match.techId && match.techCompany) {
          techNameByEmail.set(match.techId, match.techCompany.trim());
        }
        if (match.designId && match.designCompany) {
          designNameByEmail.set(match.designId, match.designCompany.trim());
        }
      });

      techPrefMap.forEach((list, techId) => {
        list.sort((a, b) => b.score - a.score);
        techPrefMap.set(techId, list.map(item => item.designId));
      });
      designPrefMap.forEach((list, designId) => {
        list.sort((a, b) => b.score - a.score);
        designPrefMap.set(designId, list.map(item => item.techId));
      });

      techNameByEmail.forEach((name, id) => {
        if (!name) return;
        if (techMap.has(id)) {
          techMap.get(id).name = name;
        } else {
          techMap.set(id, { id, name });
        }
      });
      designNameByEmail.forEach((name, id) => {
        if (!name) return;
        if (designMap.has(id)) {
          designMap.get(id).name = name;
        } else {
          designMap.set(id, { id, name });
        }
      });

      const techSchedule = {};
      const designSchedule = {};
      const roundDesignUsed = {};
      rounds.forEach(round => { roundDesignUsed[round] = new Set(); });
      const metPairs = new Set();

      allTechs.forEach(tech => { techSchedule[tech.id] = {}; });
      allDesigns.forEach(design => { designSchedule[design.id] = {}; });

      const assignments = [];
      const assigned = [];
      const usedMatchKeys = new Set();

      const pairKey = (techId, designId) => `${techId}|${designId}`;

      function getScore(techId, designId) {
        return scoreMap[pairKey(techId, designId)] || 0;
      }

      function hasRoundCapacity(round) {
        if (!roundDesignUsed[round]) roundDesignUsed[round] = new Set();
        return roundDesignUsed[round].size < tableCount;
      }

      function isSlotFree(techId, designId, round) {
        if (techSchedule[techId]?.[round]) return false;
        if (designSchedule[designId]?.[round]) return false;
        if (metPairs.has(pairKey(techId, designId))) return false;
        return true;
      }

      function assignPair(techId, designId, round, phase) {
        if (!techId || !designId) return false;
        if (!roundDesignUsed[round]) roundDesignUsed[round] = new Set();
        techSchedule[techId][round] = designId;
        designSchedule[designId][round] = techId;
        roundDesignUsed[round].add(designId);
        metPairs.add(pairKey(techId, designId));

        const score = getScore(techId, designId);
        const tableNum = techOrderMap.get(techId) || assignments.length + 1;
        const techName = getCompanyNameByEmail(techId, techMap.get(techId)?.name || techId);
        const designName = getCompanyNameByEmail(designId, designMap.get(designId)?.name || designId);

        assignments.push({
          round,
          table: tableNum,
          techCompany: techName,
          techEmail: techId,
          designCompany: designName,
          designEmail: designId,
          score,
          techPriority: null,
          designPriority: null,
          matchType: phase
        });

        usedMatchKeys.add(pairKey(techId, designId));
        return true;
      }

      function pickDesignForTech(techId, round, allowedDesignSet) {
        const prefList = techPrefMap.get(techId) || [];
        for (const designId of prefList) {
          if (allowedDesignSet && !allowedDesignSet.has(designId)) continue;
          if (!hasRoundCapacity(round)) break;
          if (roundDesignUsed[round].has(designId)) continue;
          if (!designMap.has(designId)) continue;
          if (!isSlotFree(techId, designId, round)) continue;
          return designId;
        }
        const fallbackList = allowedDesignSet ? Array.from(allowedDesignSet) : allDesigns.map(d => d.id);
        for (const designId of fallbackList) {
          if (!hasRoundCapacity(round)) break;
          if (roundDesignUsed[round].has(designId)) continue;
          if (!designMap.has(designId)) continue;
          if (!isSlotFree(techId, designId, round)) continue;
          return designId;
        }
        return null;
      }

      function pickTechForDesign(designId, round) {
        const prefList = designPrefMap.get(designId) || [];
        for (const techId of prefList) {
          if (!hasRoundCapacity(round)) break;
          if (!techMap.has(techId)) continue;
          if (roundDesignUsed[round].has(designId)) continue;
          if (!isSlotFree(techId, designId, round)) continue;
          return techId;
        }
        for (const tech of allTechs) {
          if (!hasRoundCapacity(round)) break;
          if (roundDesignUsed[round].has(designId)) continue;
          if (!isSlotFree(tech.id, designId, round)) continue;
          return tech.id;
        }
        return null;
      }

      function findAvailableRound(techId, designId) {
        for (const round of rounds) {
          if (!hasRoundCapacity(round)) continue;
          if (isSlotFree(techId, designId, round)) {
            return round;
          }
        }
        return null;
      }

      function finalize(logLabel) {
        const unassigned = cleanMatchings.filter(match => !usedMatchKeys.has(pairKey(match.techId, match.designId)));
        if (logLabel) console.log(`[${logLabel}] ìµœì¢… ë°°ì • ì™„ë£Œ: ${assignments.length}`);
        return {
          assignments,
          assigned,
          unassigned
        };
      }

      return {
        TOTAL_ROUNDS,
        rounds,
        allTechs,
        allDesigns,
        techMap,
        designMap,
        techPrefMap,
        designPrefMap,
        roundDesignUsed,
        techSchedule,
        designSchedule,
        assignPair,
        pickDesignForTech,
        pickTechForDesign,
        findAvailableRound,
        hasRoundCapacity,
        isSlotFree,
        finalize,
        scoreMap,
        cleanMatchings,
        usedMatchKeys
      };
    }
    
    // ë¼ìš´ë“œ ë°°ì • ìƒì„±
    async function generateAssignment() {
      const roundCount = parseInt(document.getElementById('roundCount').value) || 3;
      const tableCount = parseInt(document.getElementById('tableCount').value) || 10;
      const assignmentMode = document.querySelector('input[name="assignmentMode"]:checked').value;
      
      if (roundCount < 1 || tableCount < 1) {
        showNotification('ë¼ìš´ë“œ ìˆ˜ì™€ í…Œì´ë¸” ìˆ˜ëŠ” 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }
      
      if (!userCompanyMap || Object.keys(userCompanyMap).length === 0) {
        await loadUserCompanyMap();
      }
      
      // ê¸°ìˆ ê¸°ì—… ê³ ì • ì¢Œì„ ì •ë³´ ë¡œë“œ
      await loadTechFixedSeats();
      
      // ì ì€ ê·¸ë£¹ ì „ì²´ ë¼ìš´ë“œ ë°°ì • ëª¨ë“œì—ì„œëŠ” íšŒì‚¬ ë¦¬ìŠ¤íŠ¸ë„ í•„ìš”
      if (assignmentMode === 'smallerGroup' && (techCompanyList.length === 0 || designCompanyList.length === 0)) {
        await loadCompanyLists();
      }
      
      // ë§¤ì¹­ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¨¼ì € ë¡œë“œ
      if (!allMatchingData || allMatchingData.length === 0) {
        await loadMatchingData();
      }
      
      // selections ë°ì´í„°ë„ ë¡œë“œ (ë§¤ì¹­ì´ ì—†ëŠ” íŒ€ ì°¾ê¸° ìœ„í•´)
      if (!allSelectionsData || allSelectionsData.length === 0) {
        await loadSelectionsData();
      }
      
      // ë§¤ì¹­ì´ ì—†ëŠ” íŒ€ ì°¾ê¸° (ë§¤ì¹­ ë°ì´í„°ê°€ ì—†ì–´ë„ selections ë°ì´í„°ë¡œ ì°¾ì„ ìˆ˜ ìˆìŒ)
      const noMatchingTeams = findNoMatchingTeams(allMatchingData || []);
      
      if (!allMatchingData || allMatchingData.length === 0) {
        showNotification('ë§¤ì¹­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë§¤ì¹­ ìš°ì„ ìˆœìœ„ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
        // ë§¤ì¹­ ë°ì´í„°ê°€ ì—†ì–´ë„ ë§¤ì¹­ì´ ì—†ëŠ” íŒ€ì€ í‘œì‹œí•  ìˆ˜ ìˆìŒ
        return;
      }
      
      // ì‚°ìˆ ì  ê°€ëŠ¥ ì—¬ë¶€ ê³„ì‚° (ì ì€ ê·¸ë£¹ ì „ì²´ ë¼ìš´ë“œ ë°°ì • ëª¨ë“œì¸ ê²½ìš°)
      if (assignmentMode === 'smallerGroup') {
        const baseGroup = document.querySelector('input[name="smallerGroupTarget"]:checked')?.value || 'tech';
        const techCount = techCompanyList.length;
        const designCount = designCompanyList.length;
        const baseGroupCount = baseGroup === 'tech' ? techCount : designCount;
        const oppositeGroupCount = baseGroup === 'tech' ? designCount : techCount;
        
        // ì´ ìŠ¬ë¡¯ ìˆ˜
        const totalSlots = roundCount * tableCount;
        
        // ê¸°ì¤€ ê·¸ë£¹ì´ ëª¨ë“  ë¼ìš´ë“œì— ë°°ì •ë˜ë¯€ë¡œ í•„ìš”í•œ ìŠ¬ë¡¯
        const baseGroupRequiredSlots = baseGroupCount * roundCount;
        
        // ë‚¨ì€ ìŠ¬ë¡¯ ìˆ˜ (ìƒëŒ€ ê·¸ë£¹ì´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìŠ¬ë¡¯)
        const availableSlotsForOpposite = totalSlots - baseGroupRequiredSlots;
        
        // ìƒëŒ€ ê·¸ë£¹ì´ ìµœì†Œ 1íšŒì”© ë°°ì •ë˜ë ¤ë©´ í•„ìš”í•œ ìµœì†Œ ìŠ¬ë¡¯
        const minRequiredSlotsForOpposite = oppositeGroupCount;
        
        // ì‚°ìˆ ì  ê°€ëŠ¥ ì—¬ë¶€ ê³„ì‚° ê²°ê³¼
        const isArithmeticallyPossible = availableSlotsForOpposite >= minRequiredSlotsForOpposite;
        
        console.log('=== ì‚°ìˆ ì  ê°€ëŠ¥ ì—¬ë¶€ ê³„ì‚° ===');
        console.log(`ë¼ìš´ë“œ ìˆ˜: ${roundCount}`);
        console.log(`í…Œì´ë¸” ìˆ˜ (ë¼ìš´ë“œë‹¹): ${tableCount}`);
        console.log(`ì´ ìŠ¬ë¡¯ ìˆ˜: ${totalSlots} (${roundCount} ë¼ìš´ë“œ Ã— ${tableCount} í…Œì´ë¸”)`);
        console.log(`ê¸°ì¤€ ê·¸ë£¹: ${baseGroup === 'tech' ? 'ê¸°ìˆ ê¸°ì—…' : 'ë””ìì¸ê¸°ì—…'} (${baseGroupCount}ê°œ)`);
        console.log(`ìƒëŒ€ ê·¸ë£¹: ${baseGroup === 'tech' ? 'ë””ìì¸ê¸°ì—…' : 'ê¸°ìˆ ê¸°ì—…'} (${oppositeGroupCount}ê°œ)`);
        console.log(`ê¸°ì¤€ ê·¸ë£¹ì´ ëª¨ë“  ë¼ìš´ë“œì— ë°°ì •ë˜ë¯€ë¡œ í•„ìš”í•œ ìŠ¬ë¡¯: ${baseGroupRequiredSlots} (${baseGroupCount}ê°œ Ã— ${roundCount}ë¼ìš´ë“œ)`);
        console.log(`ìƒëŒ€ ê·¸ë£¹ì´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë‚¨ì€ ìŠ¬ë¡¯: ${availableSlotsForOpposite}`);
        console.log(`ìƒëŒ€ ê·¸ë£¹ì´ ìµœì†Œ 1íšŒì”© ë°°ì •ë˜ë ¤ë©´ í•„ìš”í•œ ìµœì†Œ ìŠ¬ë¡¯: ${minRequiredSlotsForOpposite}`);
        console.log(`ì‚°ìˆ ì ìœ¼ë¡œ ê°€ëŠ¥í•œê°€? ${isArithmeticallyPossible ? 'âœ… ê°€ëŠ¥' : 'âŒ ë¶ˆê°€ëŠ¥'}`);
        
        if (!isArithmeticallyPossible) {
          const shortage = minRequiredSlotsForOpposite - availableSlotsForOpposite;
          console.warn(`âš ï¸ ì‚°ìˆ ì ìœ¼ë¡œ ë¶ˆê°€ëŠ¥: ${shortage}ê°œì˜ ìŠ¬ë¡¯ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.`);
          console.warn(`í•´ê²° ë°©ë²•:`);
          console.warn(`1. ë¼ìš´ë“œ ìˆ˜ë¥¼ ${Math.ceil((baseGroupRequiredSlots + minRequiredSlotsForOpposite) / tableCount)} ì´ìƒìœ¼ë¡œ ëŠ˜ë¦¬ê¸°`);
          console.warn(`2. í…Œì´ë¸” ìˆ˜ë¥¼ ${Math.ceil((baseGroupRequiredSlots + minRequiredSlotsForOpposite) / roundCount)} ì´ìƒìœ¼ë¡œ ëŠ˜ë¦¬ê¸°`);
        } else {
          const excessSlots = availableSlotsForOpposite - minRequiredSlotsForOpposite;
          console.log(`âœ… ì—¬ìœ  ìŠ¬ë¡¯: ${excessSlots}ê°œ (ìƒëŒ€ ê·¸ë£¹ì´ í‰ê·  ${(availableSlotsForOpposite / oppositeGroupCount).toFixed(2)}íšŒ ë°°ì • ê°€ëŠ¥)`);
        }
        
        // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
        if (!isArithmeticallyPossible) {
          const shortage = minRequiredSlotsForOpposite - availableSlotsForOpposite;
          showNotification(`âš ï¸ ì‚°ìˆ ì ìœ¼ë¡œ ë¶ˆê°€ëŠ¥: ìƒëŒ€ ê·¸ë£¹ì´ ìµœì†Œ 1íšŒì”© ë°°ì •ë˜ë ¤ë©´ ${shortage}ê°œì˜ ì¶”ê°€ ìŠ¬ë¡¯ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¼ìš´ë“œ ìˆ˜ë‚˜ í…Œì´ë¸” ìˆ˜ë¥¼ ëŠ˜ë ¤ì£¼ì„¸ìš”.`, 'warning');
        }
      }
      
      // ë°°ì • ë°©ì‹ì— ë”°ë¼ ë¡œì§ ì‹¤í–‰
      let result;
      if (assignmentMode === 'priority') {
        // ë°©ì‹ 1: ë§¤ì¹­ í¬ì¸íŠ¸ë¥¼ ìš°ì„ ìœ¼ë¡œ
        result = assignRoundsByPriority(allMatchingData, roundCount, tableCount);
      } else if (assignmentMode === 'guarantee1') {
        // ë°©ì‹ 2: ì ì–´ë„ 1ê°œ ì´ìƒì˜ ë°‹ì—…ì„ ë³´ì¥í•˜ê¸°
        result = assignRoundsGuarantee1(allMatchingData, roundCount, tableCount, noMatchingTeams);
      } else if (assignmentMode === 'guaranteeX') {
        // ë°©ì‹ 3: ëª¨ë“  íŒ€ë“¤ì´ xíšŒ ì´ìƒ ë™ë“±í•˜ê²Œ ë°‹ì—…í•˜ê¸°
        const guaranteeRoundCount = parseInt(document.getElementById('guaranteeRoundCount').value) || 2;
        result = assignRoundsGuaranteeX(allMatchingData, roundCount, tableCount, guaranteeRoundCount, noMatchingTeams);
        if (!result) {
          // ë³´ì¥í•  ìˆ˜ ì—†ëŠ” ê²½ìš° (null ë°˜í™˜)
          return;
        }
      } else if (assignmentMode === 'smallerGroup') {
        result = assignRoundsBySmallerGroup(allMatchingData, roundCount, tableCount);
        if (!result) {
          return;
        }
      }

      result.noMatchingTeams = noMatchingTeams;
      result.roundCount = roundCount;
      result.tableCount = tableCount;
      result.assignmentMode = assignmentMode;
      assignmentResult = result;
      window.assignmentResult = result;

      renderAssignmentResult(result);
      markAssignmentDirty();

      document.getElementById('confirmAssignmentBtn').style.display = 'inline-block';
      document.getElementById('resetAssignmentBtn').style.display = 'inline-block';
      document.getElementById('clearAssignmentBtn').style.display = 'inline-block';

      loadConfirmedAssignment();

      showNotification(`ë¼ìš´ë“œ ë°°ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (ë°°ì •: ${result.assigned.length}ê°œ, ë¯¸ë°°ì •: ${result.unassigned.length}ê°œ, ë§¤ì¹­ ì—†ìŒ: ${noMatchingTeams.tech.length + noMatchingTeams.design.length}ê°œ)`);
    }

    function setConfirmButtonState({ disabled, label, pulse } = {}) {
      const confirmBtn = document.getElementById('confirmAssignmentBtn');
      if (!confirmBtn) return;
      if (typeof disabled === 'boolean') {
        confirmBtn.disabled = disabled;
      }
      if (typeof label === 'string') {
        confirmBtn.innerHTML = label;
      }
      if (typeof pulse === 'boolean') {
        confirmBtn.classList.toggle('btn-pulse', pulse);
      }
    }

    function markAssignmentDirty() {
      setConfirmButtonState({
        disabled: false,
        label: 'âœ… ì´ëŒ€ë¡œ í™•ì •í•˜ê¸°',
        pulse: true
      });
    }

    function markAssignmentConfirmed() {
      setConfirmButtonState({
        disabled: true,
        label: 'ğŸ‰ í™•ì • ì™„ë£Œ',
        pulse: false
      });
    }

    async function confirmAssignment() {
      if (!assignmentResult || !assignmentResult.assignments || assignmentResult.assignments.length === 0) {
        showNotification('ë¨¼ì € ë°°ì •ì„ ìƒì„±í•˜ê±°ë‚˜ ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }

      try {
        setConfirmButtonState({
          disabled: true,
          label: 'â³ í™•ì • ì¤‘...',
          pulse: false
        });

        const payload = {
          assignments: assignmentResult.assignments,
          roundCount: assignmentResult.roundCount || parseInt(document.getElementById('roundCount').value, 10) || 1,
          tableCount: assignmentResult.tableCount || parseInt(document.getElementById('tableCount').value, 10) || 1
        };

        const response = await fetch('/api/kidp2025/meetup/assignments/confirm', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const result = await response.json().catch(() => ({}));
        if (!response.ok || !result.success) {
          const message = result?.error || result?.message || 'ë°°ì • í™•ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
          throw new Error(message);
        }

        showNotification(result.message || 'ë¼ìš´ë“œ ë°°ì •ì„ í™•ì •í–ˆìŠµë‹ˆë‹¤.');
        await loadConfirmedAssignment();
        markAssignmentConfirmed();
      } catch (error) {
        console.error('ë°°ì • í™•ì • ì˜¤ë¥˜:', error);
        const message = error instanceof Error ? error.message : 'ë°°ì • í™•ì • ì¤‘ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        showNotification(message);
        setConfirmButtonState({
          disabled: false,
          label: 'âš ï¸ ë‹¤ì‹œ ì‹œë„í•˜ê¸°',
          pulse: false
        });
      }
    }

    window.confirmAssignment = confirmAssignment;

    // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // ë°°ì • í†µê³„ í‘œì‹œ
    function displayAssignmentStats(result) {
      const statsSection = document.getElementById('assignmentStats');
      const statsContent = document.getElementById('assignmentStatsContent');
      
      if (!result || !result.assignments || result.assignments.length === 0) {
        statsSection.style.display = 'none';
        return;
      }
      
      // ê¸°ì—…ë³„ ë°°ì • ë¼ìš´ë“œ ìˆ˜ ê³„ì‚°
      const companyRounds = new Map(); // companyEmail -> Set of rounds
      const companyNames = new Map(); // companyEmail -> companyName
      
      for (const assignment of result.assignments) {
        // ê¸°ìˆ ê¸°ì—…
        if (!companyRounds.has(assignment.techEmail)) {
          companyRounds.set(assignment.techEmail, new Set());
          companyNames.set(assignment.techEmail, assignment.techCompany);
        }
        companyRounds.get(assignment.techEmail).add(assignment.round);
        
        // ë””ìì¸ê¸°ì—…
        if (!companyRounds.has(assignment.designEmail)) {
          companyRounds.set(assignment.designEmail, new Set());
          companyNames.set(assignment.designEmail, assignment.designCompany);
        }
        companyRounds.get(assignment.designEmail).add(assignment.round);
      }
      
      // ë¼ìš´ë“œ ìˆ˜ë³„ë¡œ ê·¸ë£¹í™”
      const allRounds = new Set();
      const threeRounds = [];
      const twoRounds = [];
      const oneRound = [];
      const noRounds = [];
      
      const roundCount = result.roundCount || 3;
      
      // ë§¤ì¹­ ë°ì´í„°ì—ì„œ ëª¨ë“  ê¸°ì—… ì´ë©”ì¼ ìˆ˜ì§‘
      const allTechEmails = new Set();
      const allDesignEmails = new Set();
      if (allMatchingData) {
        for (const matching of allMatchingData) {
          allTechEmails.add(matching.techEmail);
          allDesignEmails.add(matching.designEmail);
        }
      }
      
      // ê¸°ìˆ ê¸°ì—… í†µê³„
      for (const email of allTechEmails) {
        const rounds = companyRounds.get(email) || new Set();
        const roundCountForCompany = rounds.size;
        const companyName = companyNames.get(email) || email;
        
        if (roundCountForCompany === roundCount) {
          allRounds.add({ email, name: companyName, type: 'tech' });
        } else if (roundCountForCompany === 3) {
          threeRounds.push({ email, name: companyName, type: 'tech' });
        } else if (roundCountForCompany === 2) {
          twoRounds.push({ email, name: companyName, type: 'tech' });
        } else if (roundCountForCompany === 1) {
          oneRound.push({ email, name: companyName, type: 'tech' });
        } else {
          noRounds.push({ email, name: companyName, type: 'tech' });
        }
      }
      
      // ë””ìì¸ê¸°ì—… í†µê³„
      for (const email of allDesignEmails) {
        const rounds = companyRounds.get(email) || new Set();
        const roundCountForCompany = rounds.size;
        const companyName = companyNames.get(email) || email;
        
        if (roundCountForCompany === roundCount) {
          allRounds.add({ email, name: companyName, type: 'design' });
        } else if (roundCountForCompany === 3) {
          threeRounds.push({ email, name: companyName, type: 'design' });
        } else if (roundCountForCompany === 2) {
          twoRounds.push({ email, name: companyName, type: 'design' });
        } else if (roundCountForCompany === 1) {
          oneRound.push({ email, name: companyName, type: 'design' });
        } else {
          noRounds.push({ email, name: companyName, type: 'design' });
        }
      }
      
      let html = '';
      
      // ëª¨ë“  ë¼ìš´ë“œì— ë°°ì •ëœ íŒ€
      if (allRounds.size > 0) {
        html += `
          <div style="margin-bottom: 25px; padding: 20px; background: #2a2a2a; border-radius: 12px; border-left: 4px solid #10B981;">
            <h4 style="color: #10B981; margin-bottom: 15px; font-size: 18px;">âœ… ëª¨ë“  ë¼ìš´ë“œ(${roundCount}ê°œ)ì— ë°°ì •ëœ íŒ€ (${allRounds.size}ê°œ)</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
              <div>
                <h5 style="color: #DC2626; margin-bottom: 10px; font-size: 14px;">ê¸°ìˆ ê¸°ì—…</h5>
                <div style="max-height: 200px; overflow-y: auto;">
        `;
        const techAll = Array.from(allRounds).filter(c => c.type === 'tech');
        if (techAll.length > 0) {
          html += techAll.map(c => `
            <div style="padding: 8px; background: #1a1a1a; border-radius: 6px; margin-bottom: 6px; font-size: 13px; color: #ffffff;">
              ${escapeHtml(c.name)}
            </div>
          `).join('');
        } else {
          html += '<div style="color: #666; font-size: 13px;">ì—†ìŒ</div>';
        }
        html += `
                </div>
              </div>
              <div>
                <h5 style="color: #DC2626; margin-bottom: 10px; font-size: 14px;">ë””ìì¸ê¸°ì—…</h5>
                <div style="max-height: 200px; overflow-y: auto;">
        `;
        const designAll = Array.from(allRounds).filter(c => c.type === 'design');
        if (designAll.length > 0) {
          html += designAll.map(c => `
            <div style="padding: 8px; background: #1a1a1a; border-radius: 6px; margin-bottom: 6px; font-size: 13px; color: #ffffff;">
              ${escapeHtml(c.name)}
            </div>
          `).join('');
        } else {
          html += '<div style="color: #666; font-size: 13px;">ì—†ìŒ</div>';
        }
        html += `
                </div>
              </div>
            </div>
          </div>
        `;
      }
      
      // 3ê°œ ë¼ìš´ë“œì— ë°°ì •ëœ íŒ€
      if (threeRounds.length > 0 && roundCount > 3) {
        html += `
          <div style="margin-bottom: 25px; padding: 20px; background: #2a2a2a; border-radius: 12px; border-left: 4px solid #3B82F6;">
            <h4 style="color: #3B82F6; margin-bottom: 15px; font-size: 18px;">ğŸ“… 3ê°œ ë¼ìš´ë“œì— ë°°ì •ëœ íŒ€ (${threeRounds.length}ê°œ)</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
              <div>
                <h5 style="color: #DC2626; margin-bottom: 10px; font-size: 14px;">ê¸°ìˆ ê¸°ì—…</h5>
                <div style="max-height: 200px; overflow-y: auto;">
        `;
        const techThree = threeRounds.filter(c => c.type === 'tech');
        if (techThree.length > 0) {
          html += techThree.map(c => `
            <div style="padding: 8px; background: #1a1a1a; border-radius: 6px; margin-bottom: 6px; font-size: 13px; color: #ffffff;">
              ${escapeHtml(c.name)}
            </div>
          `).join('');
        } else {
          html += '<div style="color: #666; font-size: 13px;">ì—†ìŒ</div>';
        }
        html += `
                </div>
              </div>
              <div>
                <h5 style="color: #DC2626; margin-bottom: 10px; font-size: 14px;">ë””ìì¸ê¸°ì—…</h5>
                <div style="max-height: 200px; overflow-y: auto;">
        `;
        const designThree = threeRounds.filter(c => c.type === 'design');
        if (designThree.length > 0) {
          html += designThree.map(c => `
            <div style="padding: 8px; background: #1a1a1a; border-radius: 6px; margin-bottom: 6px; font-size: 13px; color: #ffffff;">
              ${escapeHtml(c.name)}
            </div>
          `).join('');
        } else {
          html += '<div style="color: #666; font-size: 13px;">ì—†ìŒ</div>';
        }
        html += `
                </div>
              </div>
            </div>
          </div>
        `;
      }
      
      // 2ê°œ ë¼ìš´ë“œì— ë°°ì •ëœ íŒ€
      if (twoRounds.length > 0) {
        html += `
          <div style="margin-bottom: 25px; padding: 20px; background: #2a2a2a; border-radius: 12px; border-left: 4px solid #F59E0B;">
            <h4 style="color: #F59E0B; margin-bottom: 15px; font-size: 18px;">ğŸ“… 2ê°œ ë¼ìš´ë“œì— ë°°ì •ëœ íŒ€ (${twoRounds.length}ê°œ)</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
              <div>
                <h5 style="color: #DC2626; margin-bottom: 10px; font-size: 14px;">ê¸°ìˆ ê¸°ì—…</h5>
                <div style="max-height: 200px; overflow-y: auto;">
        `;
        const techTwo = twoRounds.filter(c => c.type === 'tech');
        if (techTwo.length > 0) {
          html += techTwo.map(c => `
            <div style="padding: 8px; background: #1a1a1a; border-radius: 6px; margin-bottom: 6px; font-size: 13px; color: #ffffff;">
              ${escapeHtml(c.name)}
            </div>
          `).join('');
        } else {
          html += '<div style="color: #666; font-size: 13px;">ì—†ìŒ</div>';
        }
        html += `
                </div>
              </div>
              <div>
                <h5 style="color: #DC2626; margin-bottom: 10px; font-size: 14px;">ë””ìì¸ê¸°ì—…</h5>
                <div style="max-height: 200px; overflow-y: auto;">
        `;
        const designTwo = twoRounds.filter(c => c.type === 'design');
        if (designTwo.length > 0) {
          html += designTwo.map(c => `
            <div style="padding: 8px; background: #1a1a1a; border-radius: 6px; margin-bottom: 6px; font-size: 13px; color: #ffffff;">
              ${escapeHtml(c.name)}
            </div>
          `).join('');
        } else {
          html += '<div style="color: #666; font-size: 13px;">ì—†ìŒ</div>';
        }
        html += `
                </div>
              </div>
            </div>
          </div>
        `;
      }
      
      // 1ê°œ ë¼ìš´ë“œì— ë°°ì •ëœ íŒ€
      if (oneRound.length > 0) {
        html += `
          <div style="margin-bottom: 25px; padding: 20px; background: #2a2a2a; border-radius: 12px; border-left: 4px solid #EF4444;">
            <h4 style="color: #EF4444; margin-bottom: 15px; font-size: 18px;">ğŸ“… 1ê°œ ë¼ìš´ë“œì— ë°°ì •ëœ íŒ€ (${oneRound.length}ê°œ)</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
              <div>
                <h5 style="color: #DC2626; margin-bottom: 10px; font-size: 14px;">ê¸°ìˆ ê¸°ì—…</h5>
                <div style="max-height: 200px; overflow-y: auto;">
        `;
        const techOne = oneRound.filter(c => c.type === 'tech');
        if (techOne.length > 0) {
          html += techOne.map(c => `
            <div style="padding: 8px; background: #1a1a1a; border-radius: 6px; margin-bottom: 6px; font-size: 13px; color: #ffffff;">
              ${escapeHtml(c.name)}
            </div>
          `).join('');
        } else {
          html += '<div style="color: #666; font-size: 13px;">ì—†ìŒ</div>';
        }
        html += `
                </div>
              </div>
              <div>
                <h5 style="color: #DC2626; margin-bottom: 10px; font-size: 14px;">ë””ìì¸ê¸°ì—…</h5>
                <div style="max-height: 200px; overflow-y: auto;">
        `;
        const designOne = oneRound.filter(c => c.type === 'design');
        if (designOne.length > 0) {
          html += designOne.map(c => `
            <div style="padding: 8px; background: #1a1a1a; border-radius: 6px; margin-bottom: 6px; font-size: 13px; color: #ffffff;">
              ${escapeHtml(c.name)}
            </div>
          `).join('');
        } else {
          html += '<div style="color: #666; font-size: 13px;">ì—†ìŒ</div>';
        }
        html += `
                </div>
              </div>
            </div>
          </div>
        `;
      }
      
      // ë¼ìš´ë“œ ë°°ì •ì´ ì—†ëŠ” íŒ€
      if (noRounds.length > 0) {
        html += `
          <div style="margin-bottom: 25px; padding: 20px; background: #2a2a2a; border-radius: 12px; border-left: 4px solid #DC2626;">
            <h4 style="color: #DC2626; margin-bottom: 15px; font-size: 18px;">âŒ ë¼ìš´ë“œ ë°°ì •ì´ ì—†ëŠ” íŒ€ (${noRounds.length}ê°œ)</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
              <div>
                <h5 style="color: #DC2626; margin-bottom: 10px; font-size: 14px;">ê¸°ìˆ ê¸°ì—…</h5>
                <div style="max-height: 200px; overflow-y: auto;">
        `;
        const techNo = noRounds.filter(c => c.type === 'tech');
        if (techNo.length > 0) {
          html += techNo.map(c => `
            <div style="padding: 8px; background: #1a1a1a; border-radius: 6px; margin-bottom: 6px; font-size: 13px; color: #ffffff;">
              ${escapeHtml(c.name)}
            </div>
          `).join('');
        } else {
          html += '<div style="color: #666; font-size: 13px;">ì—†ìŒ</div>';
        }
        html += `
                </div>
              </div>
              <div>
                <h5 style="color: #DC2626; margin-bottom: 10px; font-size: 14px;">ë””ìì¸ê¸°ì—…</h5>
                <div style="max-height: 200px; overflow-y: auto;">
        `;
        const designNo = noRounds.filter(c => c.type === 'design');
        if (designNo.length > 0) {
          html += designNo.map(c => `
            <div style="padding: 8px; background: #1a1a1a; border-radius: 6px; margin-bottom: 6px; font-size: 13px; color: #ffffff;">
              ${escapeHtml(c.name)}
            </div>
          `).join('');
        } else {
          html += '<div style="color: #666; font-size: 13px;">ì—†ìŒ</div>';
        }
        html += `
                </div>
              </div>
            </div>
          </div>
        `;
      }
      
      statsContent.innerHTML = html;
      statsSection.style.display = 'block';
      
      // ì „ì²´ ê¸°ì—… ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
      displayAllCompaniesList(result);
    }
    
    // ì „ì²´ ê¸°ì—… ë¦¬ìŠ¤íŠ¸ í‘œì‹œ (ë¼ìš´ë“œ ìˆ˜ ê¸°ì¤€)
    function displayAllCompaniesList(result) {
      const allCompaniesSection = document.getElementById('allCompaniesList');
      const techListDiv = document.getElementById('allTechCompaniesList');
      const designListDiv = document.getElementById('allDesignCompaniesList');
      
      if (!result || !result.assignments || result.assignments.length === 0) {
        allCompaniesSection.style.display = 'none';
        return;
      }
      
      // ê¸°ì—…ë³„ ë¼ìš´ë“œ ìˆ˜ ê³„ì‚°
      const companyRounds = new Map(); // companyEmail -> { name: string, rounds: Set<number>, type: 'tech' | 'design' }
      
      // ë°°ì • ë°ì´í„°ì—ì„œ ê¸°ì—…ë³„ ë¼ìš´ë“œ ìˆ˜ ê³„ì‚°
      for (const assignment of result.assignments) {
        // ê¸°ìˆ ê¸°ì—…
        if (!companyRounds.has(assignment.techEmail)) {
          companyRounds.set(assignment.techEmail, {
            name: assignment.techCompany,
            rounds: new Set(),
            type: 'tech'
          });
        }
        companyRounds.get(assignment.techEmail).rounds.add(assignment.round);
        
        // ë””ìì¸ê¸°ì—…
        if (!companyRounds.has(assignment.designEmail)) {
          companyRounds.set(assignment.designEmail, {
            name: assignment.designCompany,
            rounds: new Set(),
            type: 'design'
          });
        }
        companyRounds.get(assignment.designEmail).rounds.add(assignment.round);
      }
      
      // selections ë°ì´í„°ì—ì„œ ëª¨ë“  ê¸°ì—… ì •ë³´ ìˆ˜ì§‘ (ë°°ì •ë˜ì§€ ì•Šì€ ê¸°ì—…ë„ í¬í•¨)
      if (allSelectionsData && allSelectionsData.length > 0) {
        for (const selection of allSelectionsData) {
          const email = (selection.email || '').toLowerCase().trim();
          if (!email) continue;
          const fallbackName = selection.userCompany || selection.email || email;
          const normalizedName = getCompanyNameByEmail(email, fallbackName);
          
          if (!companyRounds.has(email)) {
            if (selection.listType === 'design') {
              companyRounds.set(email, {
                name: normalizedName,
                rounds: new Set(),
                type: 'tech'
              });
            } else if (selection.listType === 'tech') {
              companyRounds.set(email, {
                name: normalizedName,
                rounds: new Set(),
                type: 'design'
              });
            }
          } else if (normalizedName) {
            companyRounds.get(email).name = normalizedName;
          }
        }
      }
      
      // ê¸°ìˆ ê¸°ì—…ê³¼ ë””ìì¸ê¸°ì—… ë¶„ë¦¬
      const techCompanies = [];
      const designCompanies = [];
      
      for (const [email, data] of companyRounds.entries()) {
        const roundCount = data.rounds.size;
        const companyInfo = {
          email,
          name: data.name,
          roundCount,
          rounds: Array.from(data.rounds).sort((a, b) => a - b)
        };
        
        if (data.type === 'tech') {
          techCompanies.push(companyInfo);
        } else {
          designCompanies.push(companyInfo);
        }
      }
      
      // ë¼ìš´ë“œ ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ (ë‚´ë¦¼ì°¨ìˆœ)
      techCompanies.sort((a, b) => {
        if (b.roundCount !== a.roundCount) {
          return b.roundCount - a.roundCount;
        }
        return a.name.localeCompare(b.name, 'ko');
      });
      
      designCompanies.sort((a, b) => {
        if (b.roundCount !== a.roundCount) {
          return b.roundCount - a.roundCount;
        }
        return a.name.localeCompare(b.name, 'ko');
      });
      
      // ê¸°ìˆ ê¸°ì—… ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
      if (techCompanies.length > 0) {
        techListDiv.innerHTML = techCompanies.map((company, index) => {
          const roundsText = company.rounds.length > 0 
            ? `ë¼ìš´ë“œ ${company.rounds.join(', ')}` 
            : 'ë°°ì • ì—†ìŒ';
          const badgeColor = company.roundCount > 0 ? '#10B981' : '#666';
          
          return `
            <div style="padding: 12px; background: #1a1a1a; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid ${badgeColor};">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                <div style="font-size: 14px; color: #ffffff; font-weight: 600;">${index + 1}. ${escapeHtml(company.name)}</div>
                <div style="font-size: 12px; color: ${badgeColor}; font-weight: 600; background: ${badgeColor}20; padding: 4px 8px; border-radius: 4px;">
                  ${company.roundCount}ê°œ ë¼ìš´ë“œ
                </div>
              </div>
              <div style="font-size: 12px; color: #a0a0a0;">${roundsText}</div>
            </div>
          `;
        }).join('');
      } else {
        techListDiv.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">ê¸°ìˆ ê¸°ì—… ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
      }
      
      // ë””ìì¸ê¸°ì—… ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
      if (designCompanies.length > 0) {
        designListDiv.innerHTML = designCompanies.map((company, index) => {
          const roundsText = company.rounds.length > 0 
            ? `ë¼ìš´ë“œ ${company.rounds.join(', ')}` 
            : 'ë°°ì • ì—†ìŒ';
          const badgeColor = company.roundCount > 0 ? '#10B981' : '#666';
          
          return `
            <div style="padding: 12px; background: #1a1a1a; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid ${badgeColor};">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                <div style="font-size: 14px; color: #ffffff; font-weight: 600;">${index + 1}. ${escapeHtml(company.name)}</div>
                <div style="font-size: 12px; color: ${badgeColor}; font-weight: 600; background: ${badgeColor}20; padding: 4px 8px; border-radius: 4px;">
                  ${company.roundCount}ê°œ ë¼ìš´ë“œ
                </div>
              </div>
              <div style="font-size: 12px; color: #a0a0a0;">${roundsText}</div>
            </div>
          `;
        }).join('');
      } else {
        designListDiv.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">ë””ìì¸ê¸°ì—… ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
      }
      
      allCompaniesSection.style.display = 'block';
    }
    
    // ë°°ì • ê²°ê³¼ ë Œë”ë§
    function renderAssignmentResult(result) {
      const resultDiv = document.getElementById('assignmentResult');
      const summarySpan = document.getElementById('assignmentSummary');
      const tablesDiv = document.getElementById('assignmentTables');
      const unassignedSection = document.getElementById('unassignedSection');
      
      // ìš”ì•½ ì •ë³´ (ë¯¸ë°°ì •ì€ í‘œì‹œí•˜ì§€ ì•ŠìŒ)
      const totalSlots = result.roundCount * result.tableCount;
      const assignedCount = result.assignments.length;
      const noMatchingCount = result.noMatchingTeams ? (result.noMatchingTeams.tech.length + result.noMatchingTeams.design.length) : 0;
      summarySpan.textContent = `ì´ ${totalSlots}ê°œ ìŠ¬ë¡¯ ì¤‘ ${assignedCount}ê°œ ë°°ì • ì™„ë£Œ, ë§¤ì¹­ ì—†ìŒ: ${noMatchingCount}ê°œ`;
      
      // ë°°ì • ê²°ê³¼ í…Œì´ë¸” ìƒì„±
      let html = '';
      for (let round = 1; round <= result.roundCount; round++) {
        const roundAssignments = result.assignments.filter(a => a.round === round);
        html += `
          <div style="margin-bottom: 30px;">
            <h3 style="color: #DC2626; margin-bottom: 15px;">ë¼ìš´ë“œ ${round}</h3>
            <div class="table-container" style="overflow-x: auto;">
              <table style="width: 100%; border-collapse: collapse; background: #1a1a1a; border-radius: 8px; overflow: hidden;">
                <thead>
                  <tr style="background: #2a2a2a;">
                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600; width: 80px;">í…Œì´ë¸”</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600;">ê¸°ìˆ ê¸°ì—…</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600;">ë””ìì¸ê¸°ì—…</th>
                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #3a3a3a; color: #DC2626; font-weight: 600; width: 100px;">ë§¤ì¹­ ì ìˆ˜</th>
                  </tr>
                </thead>
                <tbody>
        `;
        
        // ë°°ì •ëœ í…Œì´ë¸”
        for (let table = 1; table <= result.tableCount; table++) {
          const assignment = roundAssignments.find(a => a.table === table);
          if (assignment) {
            html += `
              <tr>
                <td style="padding: 12px; text-align: center; border: 1px solid #3a3a3a; background: #1a1a1a; color: #ffffff; font-weight: 600;">${table}</td>
                <td style="padding: 12px; border: 1px solid #3a3a3a; background: #1a1a1a; color: #ffffff;">${escapeHtml(assignment.techCompany)}</td>
                <td style="padding: 12px; border: 1px solid #3a3a3a; background: #1a1a1a; color: #ffffff;">${escapeHtml(assignment.designCompany)}</td>
                <td style="padding: 12px; text-align: center; border: 1px solid #3a3a3a; background: #1a1a1a; color: #DC2626; font-weight: 600;">${assignment.score}ì </td>
              </tr>
            `;
          } else {
            html += `
              <tr>
                <td style="padding: 12px; text-align: center; border: 1px solid #3a3a3a; background: #1a1a1a; color: #666;">${table}</td>
                <td style="padding: 12px; border: 1px solid #3a3a3a; background: #1a1a1a; color: #666;" colspan="3">-</td>
              </tr>
            `;
          }
        }
        
        html += `
                </tbody>
              </table>
            </div>
          </div>
        `;
      }
      
      tablesDiv.innerHTML = html;
      resultDiv.style.display = 'block';
      
      // ë°°ì • í†µê³„ í‘œì‹œ
      displayAssignmentStats(result);
      
      // ë§¤ì¹­ì´ ì—†ëŠ” íŒ€ ëª©ë¡
      const noMatchingSection = document.getElementById('noMatchingSection');
      if (result.noMatchingTeams && (result.noMatchingTeams.tech.length > 0 || result.noMatchingTeams.design.length > 0)) {
        // ê¸°ìˆ ê¸°ì—… ëª©ë¡
        const techTbody = document.getElementById('noMatchingTechTableBody');
        if (result.noMatchingTeams.tech.length > 0) {
          techTbody.innerHTML = result.noMatchingTeams.tech.map((company, index) => `
            <tr>
              <td style="padding: 12px; border: 1px solid #3a3a3a; background: #1a1a1a; color: #ffffff;">${index + 1}</td>
              <td style="padding: 12px; border: 1px solid #3a3a3a; background: #1a1a1a; color: #ffffff;">${escapeHtml(company.companyName || company.email)}</td>
            </tr>
          `).join('');
        } else {
          techTbody.innerHTML = '<tr><td colspan="2" style="padding: 12px; text-align: center; border: 1px solid #3a3a3a; background: #1a1a1a; color: #666;">ì—†ìŒ</td></tr>';
        }
        
        // ë””ìì¸ê¸°ì—… ëª©ë¡
        const designTbody = document.getElementById('noMatchingDesignTableBody');
        if (result.noMatchingTeams.design.length > 0) {
          designTbody.innerHTML = result.noMatchingTeams.design.map((company, index) => `
            <tr>
              <td style="padding: 12px; border: 1px solid #3a3a3a; background: #1a1a1a; color: #ffffff;">${index + 1}</td>
              <td style="padding: 12px; border: 1px solid #3a3a3a; background: #1a1a1a; color: #ffffff;">${escapeHtml(company.companyName || company.email)}</td>
            </tr>
          `).join('');
        } else {
          designTbody.innerHTML = '<tr><td colspan="2" style="padding: 12px; text-align: center; border: 1px solid #3a3a3a; background: #1a1a1a; color: #666;">ì—†ìŒ</td></tr>';
        }
        
        noMatchingSection.style.display = 'block';
      } else {
        noMatchingSection.style.display = 'none';
      }
    }
    
    // ë°°ì • ê²°ê³¼ CSV ë‹¤ìš´ë¡œë“œ
    function exportAssignmentCSV() {
      if (!assignmentResult) {
        showNotification('ë¨¼ì € ë°°ì •ì„ ìƒì„±í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      let csv = '\uFEFF'; // BOM for Excel
      csv += 'ë¼ìš´ë“œ,í…Œì´ë¸”,ê¸°ìˆ ê¸°ì—…,ë””ìì¸ê¸°ì—…,ë§¤ì¹­ì ìˆ˜\n';
      
      for (const assignment of assignmentResult.assignments) {
        csv += `${assignment.round},${assignment.table},"${assignment.techCompany}","${assignment.designCompany}",${assignment.score}\n`;
      }
      
      // ë¯¸ë°°ì • íŒ€ë„ ì¶”ê°€
      if (assignmentResult.unassigned.length > 0) {
        csv += '\në¯¸ë°°ì • íŒ€\n';
        csv += 'ìˆœìœ„,ê¸°ìˆ ê¸°ì—…,ë””ìì¸ê¸°ì—…,ë§¤ì¹­ì ìˆ˜\n';
        assignmentResult.unassigned.forEach((matching, index) => {
          csv += `${index + 1},"${matching.techCompany}","${matching.designCompany}",${matching.totalScore}\n`;
        });
      }
      
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `ë¼ìš´ë“œë°°ì •_${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showNotification('ë¼ìš´ë“œ ë°°ì • CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    window.addEventListener('load', () => {
      // ì €ì¥ëœ Google Sheets URL ë¶ˆëŸ¬ì˜¤ê¸° (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©)
      const techSheetUrl = localStorage.getItem('kidp2025_tech_sheet_url') || TECH_SHEET_EDIT_URL;
      const designSheetUrl = localStorage.getItem('kidp2025_design_sheet_url') || DESIGN_SHEET_EDIT_URL;
      
      document.getElementById('techSheetUrl').value = techSheetUrl;
      document.getElementById('designSheetUrl').value = designSheetUrl;
      
      // ê¸°ë³¸ì ìœ¼ë¡œ Google Sheets ë¡œë“œ
      loadSheet('tech');
      loadSheet('design');
      
      // ë¡œì»¬ í…Œì´ë¸” ë°ì´í„°ëŠ” í•„ìš”ì‹œì—ë§Œ ë¶ˆëŸ¬ì˜¤ê¸°
      // loadData('tech');
      // loadData('design');
    });
    
    // ìë™ ì €ì¥ (ì…ë ¥ í›„ 2ì´ˆ ì§€ì—°)
    let saveTimeout;
    document.addEventListener('input', (e) => {
      if (e.target.tagName === 'INPUT' && e.target.dataset.field) {
        clearTimeout(saveTimeout);
        saveTimeout = setTimeout(() => {
          saveData(currentTab);
        }, 2000);
      }
    });
  </script>
</body>
</html>



